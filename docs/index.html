<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆäºŒæ•°å­¦å‹è½´é¢˜è®­ç»ƒç³»ç»Ÿ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            display: none;
        }

        .celebration-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(255,215,0,0.8);
            z-index: 10000;
            animation: celebrationPulse 1s ease-in-out infinite;
            display: none;
            text-align: center;
            pointer-events: none;
        }

        @keyframes celebrationPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }

        h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .category-tab {
            flex: 1;
            min-width: 120px;
            padding: 10px 16px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .category-tab.active {
            background: white;
            color: #667eea;
            border-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            display: none;
        }

        .card.active {
            display: block;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .difficulty {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .difficulty-basic {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .points {
            font-size: 12px;
            color: #666;
        }

        .question {
            font-size: 17px;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .formula {
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 8px 0;
            display: inline-block;
        }

        canvas {
            display: block;
            margin: 0 auto 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            touch-action: none;
            max-width: 100%;
            height: auto;
        }

        .input-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Noto Sans SC', sans-serif;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .result {
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            display: none;
        }

        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block;
            animation: bounceIn 0.5s ease;
        }

        .result.wrong {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .hint {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
            font-size: 14px;
            display: none;
        }

        .mistakes-panel {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            display: none;
        }

        .mistakes-panel.active {
            display: block;
        }

        .mistake-item {
            padding: 12px;
            border-left: 4px solid #e74c3c;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .mistake-type {
            font-size: 12px;
            color: #e74c3c;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .mistake-question {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .mistake-answer {
            font-size: 13px;
            color: #27ae60;
            font-weight: 500;
        }

        @media (max-width: 600px) {
            .container {
                padding: 16px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .question {
                font-size: 16px;
                padding: 14px;
            }
            
            .stat-item {
                padding: 8px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .category-tab {
                min-width: 100px;
                font-size: 12px;
                padding: 8px 12px;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            header {
                padding: 20px 0;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .subtitle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <canvas id="fireworks-canvas"></canvas>
    <div class="celebration-text" id="celebration-text">ğŸ‰ å®Œç¾ï¼100%æ­£ç¡®ç‡ ğŸ‰</div>
    <div class="container">
        <header>
            <h1>åˆäºŒæ•°å­¦å‹è½´é¢˜è®­ç»ƒç³»ç»Ÿ</h1>
            <div class="subtitle">ç›®æ ‡ï¼šä»105åˆ†æå‡åˆ°115+åˆ† | åŒ—å¸ˆå¤§ç‰ˆ</div>
        </header>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="correct-count">0</div>
                <div class="stat-label">ç­”å¯¹</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="wrong-count">0</div>
                <div class="stat-label">ç­”é”™</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">æ­£ç¡®ç‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">è¿èƒœ</div>
            </div>
        </div>

        <div class="category-tabs">
            <button class="category-tab active" onclick="switchCategory('function')">å‡½æ•°å›¾åƒ</button>
            <button class="category-tab" onclick="switchCategory('moving')">åŠ¨ç‚¹é—®é¢˜</button>
            <button class="category-tab" onclick="switchCategory('inequality')">ä¸ç­‰å¼ç»„</button>
            <button class="category-tab" onclick="switchCategory('factorization')">å› å¼åˆ†è§£</button>
            <button class="category-tab" onclick="switchCategory('fraction')">åˆ†å¼è¿ç®—</button>
            <button class="category-tab" onclick="switchCategory('quadrilateral')">å››è¾¹å½¢</button>
            <button class="category-tab" onclick="switchCategory('mistakes')">é”™é¢˜æœ¬</button>
        </div>

        <!-- å‡½æ•°å›¾åƒç»ƒä¹  -->
        <div class="card active" id="function-card">
            <div class="question-meta">
                <span class="difficulty difficulty-hard" id="function-difficulty">å‹è½´é¢˜</span>
                <span class="points" id="function-points">åˆ†å€¼ï¼š12åˆ†</span>
            </div>
            <div class="question" id="function-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <canvas id="function-canvas" width="350" height="350"></canvas>
            <div class="input-group">
                <label>å‡½æ•°è§£æå¼ï¼ˆä¾‹å¦‚ï¼šy=2x+1ï¼‰</label>
                <input type="text" id="function-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            <button class="btn btn-primary" onclick="checkFunctionAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showFunctionHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateFunctionQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="function-result"></div>
            <div class="hint" id="function-hint"></div>
        </div>

        <!-- åŠ¨ç‚¹é—®é¢˜ç»ƒä¹  -->
        <div class="card" id="moving-card">
            <div class="question-meta">
                <span class="difficulty difficulty-hard">å‹è½´é¢˜</span>
                <span class="points">åˆ†å€¼ï¼š14åˆ†</span>
            </div>
            <div class="question" id="moving-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <canvas id="moving-canvas" width="350" height="280"></canvas>
            <div class="input-group">
                <label>é¢ç§¯ S ä¸æ—¶é—´ t çš„å…³ç³»ï¼ˆä¾‹å¦‚ï¼šS=9tï¼‰</label>
                <input type="text" id="moving-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            <button class="btn btn-primary" onclick="checkMovingAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showMovingHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateMovingQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="moving-result"></div>
            <div class="hint" id="moving-hint"></div>
        </div>

        <!-- ä¸ç­‰å¼ç»„ç»ƒä¹  -->
        <div class="card" id="inequality-card">
            <div class="question-meta">
                <span class="difficulty difficulty-medium">ä¸­æ¡£é¢˜</span>
                <span class="points">åˆ†å€¼ï¼š8åˆ†</span>
            </div>
            <div class="question" id="inequality-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <div class="input-group">
                <label>è§£é›†ï¼ˆä¾‹å¦‚ï¼š2&lt;xâ‰¤5ï¼‰</label>
                <input type="text" id="inequality-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            <button class="btn btn-primary" onclick="checkInequalityAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showInequalityHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateInequalityQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="inequality-result"></div>
            <div class="hint" id="inequality-hint"></div>
        </div>

        <!-- å› å¼åˆ†è§£ç»ƒä¹  -->
        <div class="card" id="factorization-card">
            <div class="question-meta">
                <span class="difficulty difficulty-basic">åŸºç¡€é¢˜</span>
                <span class="points">åˆ†å€¼ï¼š6åˆ†</span>
            </div>
            <div class="question" id="factorization-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <div class="input-group">
                <label>åˆ†è§£ç»“æœï¼ˆä¾‹å¦‚ï¼š(x+1)(x-1)ï¼‰</label>
                <input type="text" id="factorization-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            <button class="btn btn-primary" onclick="checkFactorizationAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showFactorizationHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateFactorizationQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="factorization-result"></div>
            <div class="hint" id="factorization-hint"></div>
        </div>

        <!-- åˆ†å¼è¿ç®—ç»ƒä¹  -->
        <div class="card" id="fraction-card">
            <div class="question-meta">
                <span class="difficulty difficulty-medium">ä¸­æ¡£é¢˜</span>
                <span class="points">åˆ†å€¼ï¼š8åˆ†</span>
            </div>
            <div class="question" id="fraction-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <div class="input-group">
                <label>è®¡ç®—ç»“æœ</label>
                <input type="text" id="fraction-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            <button class="btn btn-primary" onclick="checkFractionAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showFractionHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateFractionQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="fraction-result"></div>
            <div class="hint" id="fraction-hint"></div>
        </div>

        <!-- å››è¾¹å½¢ç»ƒä¹  -->
        <div class="card" id="quadrilateral-card">
            <div class="question-meta">
                <span class="difficulty difficulty-medium">ä¸­æ¡£é¢˜</span>
                <span class="points">åˆ†å€¼ï¼š10åˆ†</span>
            </div>
            <div class="question" id="quadrilateral-question">é¢˜ç›®åŠ è½½ä¸­...</div>
            <div class="input-group">
                <label>é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</label>
                <select id="quadrilateral-answer">
                    <option value="">è¯·é€‰æ‹©</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="checkQuadrilateralAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showQuadrilateralHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateQuadrilateralQuestion()">ä¸‹ä¸€é¢˜</button>
            <div class="result" id="quadrilateral-result"></div>
            <div class="hint" id="quadrilateral-hint"></div>
        </div>

        <!-- é”™é¢˜æœ¬ -->
        <div class="mistakes-panel" id="mistakes-panel">
            <h3 style="margin-bottom: 16px;">ğŸ“ é”™é¢˜æœ¬</h3>
            <div id="mistakes-list"></div>
            <button class="btn btn-secondary" onclick="clearMistakes()" style="margin-top: 16px;">æ¸…ç©ºé”™é¢˜æœ¬</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentFunctionQuestion = null;
        let currentMovingQuestion = null;
        let currentInequalityQuestion = null;
        let currentFactorizationQuestion = null;
        let currentFractionQuestion = null;
        let currentQuadrilateralQuestion = null;
        
        let correctCount = 0;
        let wrongCount = 0;
        let streak = 0;
        let mistakes = [];

        // åˆ‡æ¢åˆ†ç±»
        function switchCategory(category) {
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.getElementById('mistakes-panel').classList.remove('active');
            
            const tabs = document.querySelectorAll('.category-tab');
            let index = 0;
            
            if (category === 'function') index = 0;
            else if (category === 'moving') index = 1;
            else if (category === 'inequality') index = 2;
            else if (category === 'factorization') index = 3;
            else if (category === 'fraction') index = 4;
            else if (category === 'quadrilateral') index = 5;
            else if (category === 'mistakes') {
                tabs[6].classList.add('active');
                document.getElementById('mistakes-panel').classList.add('active');
                renderMistakes();
                return;
            }
            
            tabs[index].classList.add('active');
            document.getElementById(`${category}-card`).classList.add('active');
            
            // ç”Ÿæˆé¢˜ç›®
            if (category === 'function') generateFunctionQuestion();
            else if (category === 'moving') generateMovingQuestion();
            else if (category === 'inequality') generateInequalityQuestion();
            else if (category === 'factorization') generateFactorizationQuestion();
            else if (category === 'fraction') generateFractionQuestion();
            else if (category === 'quadrilateral') generateQuadrilateralQuestion();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('wrong-count').textContent = wrongCount;
            
            const total = correctCount + wrongCount;
            const accuracy = total > 0 ? Math.round(correctCount / total * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('streak').textContent = streak;
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°100%æ­£ç¡®ç‡
            if (accuracy === 100 && total >= 10) {
                triggerCelebration();
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('mathStats', JSON.stringify({
                correct: correctCount,
                wrong: wrongCount,
                streak: streak
            }));
        }

        // æ·»åŠ åˆ°é”™é¢˜æœ¬
        function addMistake(type, question, userAnswer, correctAnswer) {
            mistakes.push({
                type: type,
                question: question,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                time: new Date().toLocaleString()
            });
            localStorage.setItem('mathMistakes', JSON.stringify(mistakes));
        }

        // æ¸²æŸ“é”™é¢˜æœ¬
        function renderMistakes() {
            const container = document.getElementById('mistakes-list');
            
            if (mistakes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— é”™é¢˜ï¼Œç»§ç»­ä¿æŒï¼</p>';
                return;
            }
            
            container.innerHTML = mistakes.map((m, i) => `
                <div class="mistake-item">
                    <div class="mistake-type">${m.type} - ${m.time}</div>
                    <div class="mistake-question">${m.question}</div>
                    <div style="font-size: 13px; color: #e74c3c; margin-top: 4px;">ä½ çš„ç­”æ¡ˆï¼š${m.userAnswer}</div>
                    <div class="mistake-answer">æ­£ç¡®ç­”æ¡ˆï¼š${m.correctAnswer}</div>
                </div>
            `).reverse().join('');
        }

        // æ¸…ç©ºé”™é¢˜æœ¬
        function clearMistakes() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºé”™é¢˜æœ¬å—ï¼Ÿ')) {
                mistakes = [];
                localStorage.removeItem('mathMistakes');
                renderMistakes();
            }
        }

        // å‡½æ•°å›¾åƒé¢˜ç›®ï¼ˆä¿ç•™åŸä»£ç ï¼‰
        function generateFunctionQuestion() {
            const types = ['linear', 'inverse'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'linear') {
                const k = (Math.floor(Math.random() * 9) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const b = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                
                currentFunctionQuestion = {
                    type: 'linear',
                    k: k,
                    b: b,
                    answer: `y=${k}x${b >= 0 ? '+' : ''}${b}`,
                    points: []
                };
                
                for (let x = -3; x <= 3; x++) {
                    const y = k * x + b;
                    if (y >= -5 && y <= 5) {
                        currentFunctionQuestion.points.push({x, y});
                    }
                }
                
                document.getElementById('function-question').innerHTML = 
                    `å¦‚å›¾ï¼Œç›´çº¿ç»è¿‡ç‚¹ A(${currentFunctionQuestion.points[0].x}, ${currentFunctionQuestion.points[0].y}) å’Œ B(${currentFunctionQuestion.points[1].x}, ${currentFunctionQuestion.points[1].y})ï¼Œæ±‚è¿™æ¡ç›´çº¿çš„å‡½æ•°è§£æå¼ã€‚`;
                
                drawFunctionGraph();
            } else {
                const k = (Math.floor(Math.random() * 20) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const x0 = Math.floor(Math.random() * 5) + 1;
                const y0 = k / x0;
                
                currentFunctionQuestion = {
                    type: 'inverse',
                    k: k,
                    answer: `y=${k}/x`,
                    points: [{x: x0, y: y0}]
                };
                
                document.getElementById('function-question').innerHTML = 
                    `å¦‚å›¾ï¼ŒåŒæ›²çº¿ç»è¿‡ç‚¹ A(${x0}, ${y0})ï¼Œæ±‚è¯¥åæ¯”ä¾‹å‡½æ•°çš„è§£æå¼ã€‚`;
                
                drawInverseGraph();
            }
            
            document.getElementById('function-answer').value = '';
            document.getElementById('function-result').className = 'result';
            document.getElementById('function-result').textContent = '';
            document.getElementById('function-hint').style.display = 'none';
        }

        function drawFunctionGraph() {
            const canvas = document.getElementById('function-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const padding = 40;
            const axisLength = w - padding * 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(padding, h / 2);
            ctx.lineTo(w - padding, h / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(w / 2, padding);
            ctx.lineTo(w / 2, h - padding);
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px Noto Sans SC';
            ctx.textAlign = 'center';
            
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const x = w / 2 + i * (axisLength / 10);
                    const y = h / 2;
                    
                    ctx.beginPath();
                    ctx.moveTo(x, y - 5);
                    ctx.lineTo(x, y + 5);
                    ctx.stroke();
                    
                    ctx.fillText(i.toString(), x, y + 20);
                }
            }
            
            ctx.textAlign = 'right';
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const x = w / 2;
                    const y = h / 2 - i * (axisLength / 10);
                    
                    ctx.beginPath();
                    ctx.moveTo(x - 5, y);
                    ctx.lineTo(x + 5, y);
                    ctx.stroke();
                    
                    ctx.fillText(i.toString(), x - 10, y + 4);
                }
            }
            
            const {k, b} = currentFunctionQuestion;
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = padding; px <= w - padding; px++) {
                const x = (px - w / 2) / (axisLength / 10);
                const y = k * x + b;
                const py = h / 2 - y * (axisLength / 10);
                
                if (py >= padding && py <= h - padding) {
                    if (px === padding) {
                        ctx.moveTo(px, py);
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
            }
            ctx.stroke();
            
            ctx.fillStyle = '#764ba2';
            currentFunctionQuestion.points.slice(0, 2).forEach(point => {
                const px = w / 2 + point.x * (axisLength / 10);
                const py = h / 2 - point.y * (axisLength / 10);
                
                ctx.beginPath();
                ctx.arc(px, py, 6, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawInverseGraph() {
            const canvas = document.getElementById('function-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const padding = 40;
            const axisLength = w - padding * 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(padding, h / 2);
            ctx.lineTo(w - padding, h / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(w / 2, padding);
            ctx.lineTo(w / 2, h - padding);
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px Noto Sans SC';
            ctx.textAlign = 'center';
            
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const x = w / 2 + i * (axisLength / 10);
                    const y = h / 2;
                    
                    ctx.beginPath();
                    ctx.moveTo(x, y - 5);
                    ctx.lineTo(x, y + 5);
                    ctx.stroke();
                    
                    ctx.fillText(i.toString(), x, y + 20);
                }
            }
            
            ctx.textAlign = 'right';
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const x = w / 2;
                    const y = h / 2 - i * (axisLength / 10);
                    
                    ctx.beginPath();
                    ctx.moveTo(x - 5, y);
                    ctx.lineTo(x + 5, y);
                    ctx.stroke();
                    
                    ctx.fillText(i.toString(), x - 10, y + 4);
                }
            }
            
            const {k} = currentFunctionQuestion;
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            for (let x = 0.1; x <= 5; x += 0.1) {
                const y = k / x;
                if (y >= -5 && y <= 5) {
                    const px = w / 2 + x * (axisLength / 10);
                    const py = h / 2 - y * (axisLength / 10);
                    
                    if (x === 0.1) {
                        ctx.moveTo(px, py);
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
            }
            ctx.stroke();
            
            ctx.beginPath();
            for (let x = -5; x <= -0.1; x += 0.1) {
                const y = k / x;
                if (y >= -5 && y <= 5) {
                    const px = w / 2 + x * (axisLength / 10);
                    const py = h / 2 - y * (axisLength / 10);
                    
                    if (x === -5) {
                        ctx.moveTo(px, py);
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
            }
            ctx.stroke();
            
            ctx.fillStyle = '#764ba2';
            const point = currentFunctionQuestion.points[0];
            const px = w / 2 + point.x * (axisLength / 10);
            const py = h / 2 - point.y * (axisLength / 10);
            
            ctx.beginPath();
            ctx.arc(px, py, 6, 0, Math.PI * 2);
            ctx.fill();
        }

        function checkFunctionAnswer() {
            const userAnswer = document.getElementById('function-answer').value.replace(/\s/g, '');
            const correctAnswer = currentFunctionQuestion.answer.replace(/\s/g, '');
            
            const resultDiv = document.getElementById('function-result');
            
            if (userAnswer === correctAnswer || userAnswer.replace(/y=/, '') === correctAnswer.replace(/y=/, '')) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.textContent = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentFunctionQuestion.answer}`;
                wrongCount++;
                streak = 0;
                addMistake('å‡½æ•°å›¾åƒ', document.getElementById('function-question').textContent, userAnswer, currentFunctionQuestion.answer);
            }
            
            updateStats();
        }

        function showFunctionHint() {
            const hintDiv = document.getElementById('function-hint');
            
            if (currentFunctionQuestion.type === 'linear') {
                hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. è®¾å‡½æ•°è§£æå¼ä¸º y = kx + b<br>2. å°†ä¸¤ä¸ªç‚¹çš„åæ ‡ä»£å…¥æ–¹ç¨‹ç»„<br>3. è§£æ–¹ç¨‹ç»„æ±‚å‡º k å’Œ b çš„å€¼`;
            } else {
                hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. è®¾åæ¯”ä¾‹å‡½æ•°è§£æå¼ä¸º y = k/x<br>2. å°†ç‚¹çš„åæ ‡ä»£å…¥ï¼Œæ±‚å‡º k çš„å€¼<br>3. æ³¨æ„ï¼šk = x Ã— y`;
            }
            
            hintDiv.style.display = 'block';
        }

        // åŠ¨ç‚¹é—®é¢˜ï¼ˆä¿ç•™åŸä»£ç ï¼‰
        function generateMovingQuestion() {
            const width = Math.floor(Math.random() * 4) + 6;
            const height = Math.floor(Math.random() * 4) + 6;
            const pSpeed = Math.floor(Math.random() * 3) + 1;
            const qSpeed = Math.floor(Math.random() * 3) + 1;
            
            currentMovingQuestion = {
                width: width,
                height: height,
                pSpeed: pSpeed,
                qSpeed: qSpeed,
                answer: `S=${width * pSpeed / 2}t`,
                maxTime: Math.min(height / pSpeed, width / qSpeed)
            };
            
            document.getElementById('moving-question').innerHTML = `
                å¦‚å›¾ï¼Œåœ¨çŸ©å½¢ ABCD ä¸­ï¼ŒAB = ${width}ï¼ŒBC = ${height}ã€‚ç‚¹ P ä»ç‚¹ A å‡ºå‘ï¼Œä»¥æ¯ç§’ ${pSpeed} ä¸ªå•ä½çš„é€Ÿåº¦æ²¿ AD è¾¹å‘ D è¿åŠ¨ï¼Œç‚¹ Q ä»ç‚¹ B å‡ºå‘ï¼Œä»¥æ¯ç§’ ${qSpeed} ä¸ªå•ä½çš„é€Ÿåº¦æ²¿ BC è¾¹å‘ C è¿åŠ¨ã€‚ä¸¤ç‚¹åŒæ—¶å‡ºå‘ï¼Œè¿åŠ¨æ—¶é—´ä¸º t ç§’ã€‚è®¾ t ç§’åï¼Œâ–³PBQ çš„é¢ç§¯ä¸º Sï¼Œæ±‚ S ä¸ t çš„å‡½æ•°å…³ç³»å¼ã€‚
            `;
            
            drawMovingGraph();
            
            document.getElementById('moving-answer').value = '';
            document.getElementById('moving-result').className = 'result';
            document.getElementById('moving-result').textContent = '';
            document.getElementById('moving-hint').style.display = 'none';
        }

        function drawMovingGraph() {
            const canvas = document.getElementById('moving-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const {width, height, pSpeed, qSpeed} = currentMovingQuestion;
            
            const scale = Math.min((w - 80) / width, (h - 80) / height);
            const offsetX = (w - width * scale) / 2;
            const offsetY = (h - height * scale) / 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.strokeRect(offsetX, offsetY, width * scale, height * scale);
            
            ctx.fillStyle = '#333';
            ctx.font = '16px Noto Sans SC';
            ctx.textAlign = 'center';
            
            const points = {
                A: {x: offsetX, y: offsetY + height * scale},
                B: {x: offsetX + width * scale, y: offsetY + height * scale},
                C: {x: offsetX + width * scale, y: offsetY},
                D: {x: offsetX, y: offsetY}
            };
            
            ctx.fillText('A', points.A.x - 20, points.A.y + 5);
            ctx.fillText('B', points.B.x + 20, points.B.y + 5);
            ctx.fillText('C', points.C.x + 20, points.C.y + 5);
            ctx.fillText('D', points.D.x - 20, points.D.y + 5);
            
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText(`AB = ${width}`, (points.A.x + points.B.x) / 2, points.A.y + 30);
            ctx.fillText(`BC = ${height}`, points.B.x + 30, (points.B.y + points.C.y) / 2);
            
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(points.A.x, points.A.y - 20);
            ctx.lineTo(points.A.x, points.A.y - height * scale + 20);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(points.A.x - 8, points.A.y - height * scale + 30);
            ctx.lineTo(points.A.x, points.A.y - height * scale + 20);
            ctx.lineTo(points.A.x + 8, points.A.y - height * scale + 30);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(points.B.x, points.B.y - 20);
            ctx.lineTo(points.B.x, points.B.y - height * scale + 20);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(points.B.x - 8, points.B.y - height * scale + 30);
            ctx.lineTo(points.B.x, points.B.y - height * scale + 20);
            ctx.lineTo(points.B.x + 8, points.B.y - height * scale + 30);
            ctx.stroke();
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '12px Noto Sans SC';
            ctx.fillText(`v=${pSpeed}`, points.A.x - 35, points.A.y - height * scale / 2);
            ctx.fillText(`v=${qSpeed}`, points.B.x + 35, points.B.y - height * scale / 2);
            
            ctx.fillStyle = '#764ba2';
            ctx.beginPath();
            ctx.arc(points.A.x, points.A.y - height * scale / 3, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('P', points.A.x - 15, points.A.y - height * scale / 3 + 5);
            
            ctx.beginPath();
            ctx.arc(points.B.x, points.B.y - height * scale / 3, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('Q', points.B.x + 15, points.B.y - height * scale / 3 + 5);
        }

        function checkMovingAnswer() {
            const userAnswer = document.getElementById('moving-answer').value.replace(/\s/g, '');
            const correctAnswer = currentMovingQuestion.answer.replace(/\s/g, '');
            
            const resultDiv = document.getElementById('moving-result');
            
            if (userAnswer === correctAnswer || userAnswer.replace(/S=/, '') === correctAnswer.replace(/S=/, '')) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.textContent = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentMovingQuestion.answer} (0 â‰¤ t â‰¤ ${currentMovingQuestion.maxTime.toFixed(2)})`;
                wrongCount++;
                streak = 0;
                addMistake('åŠ¨ç‚¹é—®é¢˜', document.getElementById('moving-question').textContent, userAnswer, currentMovingQuestion.answer);
            }
            
            updateStats();
        }

        function showMovingHint() {
            const hintDiv = document.getElementById('moving-hint');
            const {width, pSpeed, qSpeed} = currentMovingQuestion;
            
            hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. â–³PBQ çš„é¢ç§¯ = Â½ Ã— PB Ã— BQ<br>2. PB = ${width}ï¼ˆä¸å˜ï¼‰<br>3. BQ = ${qSpeed}tï¼ˆéšæ—¶é—´å˜åŒ–ï¼‰<br>4. æ‰€ä»¥ S = Â½ Ã— ${width} Ã— ${qSpeed}t = ${width * qSpeed / 2}t`;
            
            hintDiv.style.display = 'block';
        }

        // ä¸ç­‰å¼ç»„é¢˜ç›®
        function generateInequalityQuestion() {
            const a1 = Math.floor(Math.random() * 5) + 2;
            const b1 = Math.floor(Math.random() * 10) + 1;
            const a2 = Math.floor(Math.random() * 5) + 2;
            const b2 = Math.floor(Math.random() * 10) + 1;
            
            currentInequalityQuestion = {
                answer: `${Math.max(b1/a1, b2/a2)}<xâ‰¤${Math.min(b1/a1, b2/a2)}`,
                solution: `è§£ä¸ç­‰å¼1å¾—ï¼šx>${b1/a1}<br>è§£ä¸ç­‰å¼2å¾—ï¼šxâ‰¤${b2/a2}<br>å–äº¤é›†å¾—ï¼š${Math.max(b1/a1, b2/a2)}<xâ‰¤${Math.min(b1/a1, b2/a2)}`
            };
            
            document.getElementById('inequality-question').innerHTML = `
                è§£ä¸ç­‰å¼ç»„ï¼š<br>
                <div class="formula">${a1}x > ${b1}</div><br>
                <div class="formula">${a2}x â‰¤ ${b2}</div>
            `;
            
            document.getElementById('inequality-answer').value = '';
            document.getElementById('inequality-result').className = 'result';
            document.getElementById('inequality-result').textContent = '';
            document.getElementById('inequality-hint').style.display = 'none';
        }

        function checkInequalityAnswer() {
            const userAnswer = document.getElementById('inequality-answer').value.replace(/\s/g, '');
            const correctAnswer = currentInequalityQuestion.answer.replace(/\s/g, '');
            
            const resultDiv = document.getElementById('inequality-result');
            
            if (userAnswer === correctAnswer) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.innerHTML = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚<br>æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentInequalityQuestion.answer}<br><br>${currentInequalityQuestion.solution}`;
                wrongCount++;
                streak = 0;
                addMistake('ä¸ç­‰å¼ç»„', document.getElementById('inequality-question').textContent, userAnswer, currentInequalityQuestion.answer);
            }
            
            updateStats();
        }

        function showInequalityHint() {
            const hintDiv = document.getElementById('inequality-hint');
            hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. åˆ†åˆ«è§£ä¸¤ä¸ªä¸ç­‰å¼<br>2. ç”»å‡ºæ•°è½´æ‰¾å…¬å…±éƒ¨åˆ†<br>3. æ³¨æ„ä¸ç­‰å·æ–¹å‘`;
            hintDiv.style.display = 'block';
        }

        // å› å¼åˆ†è§£é¢˜ç›®
        function generateFactorizationQuestion() {
            const types = ['difference_of_squares', 'perfect_square', 'common_factor'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'difference_of_squares') {
                const a = Math.floor(Math.random() * 10) + 2;
                currentFactorizationQuestion = {
                    answer: `(x+${a})(x-${a})`,
                    expression: `xÂ²-${a*a}`
                };
            } else if (type === 'perfect_square') {
                const a = Math.floor(Math.random() * 10) + 2;
                const b = 2 * a;
                currentFactorizationQuestion = {
                    answer: `(x+${a})Â²`,
                    expression: `xÂ²+${b}x+${a*a}`
                };
            } else {
                const a = Math.floor(Math.random() * 10) + 2;
                const b = Math.floor(Math.random() * 10) + 1;
                currentFactorizationQuestion = {
                    answer: `${a}(x+${b})`,
                    expression: `${a}x+${a*b}`
                };
            }
            
            document.getElementById('factorization-question').innerHTML = `
                åˆ†è§£å› å¼ï¼š<br>
                <div class="formula">${currentFactorizationQuestion.expression}</div>
            `;
            
            document.getElementById('factorization-answer').value = '';
            document.getElementById('factorization-result').className = 'result';
            document.getElementById('factorization-result').textContent = '';
            document.getElementById('factorization-hint').style.display = 'none';
        }

        function checkFactorizationAnswer() {
            const userAnswer = document.getElementById('factorization-answer').value.replace(/\s/g, '');
            const correctAnswer = currentFactorizationQuestion.answer.replace(/\s/g, '');
            
            const resultDiv = document.getElementById('factorization-result');
            
            if (userAnswer === correctAnswer) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.textContent = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentFactorizationQuestion.answer}`;
                wrongCount++;
                streak = 0;
                addMistake('å› å¼åˆ†è§£', document.getElementById('factorization-question').textContent, userAnswer, currentFactorizationQuestion.answer);
            }
            
            updateStats();
        }

        function showFactorizationHint() {
            const hintDiv = document.getElementById('factorization-hint');
            hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. å…ˆçœ‹æ˜¯å¦æœ‰å…¬å› å¼<br>2. å†çœ‹æ˜¯å¦ç¬¦åˆå…¬å¼<br>3. å¹³æ–¹å·®ï¼šaÂ²-bÂ²=(a+b)(a-b)<br>4. å®Œå…¨å¹³æ–¹ï¼šaÂ²Â±2ab+bÂ²=(aÂ±b)Â²`;
            hintDiv.style.display = 'block';
        }

        // åˆ†å¼è¿ç®—é¢˜ç›®
        function generateFractionQuestion() {
            const a = Math.floor(Math.random() * 5) + 2;
            const b = Math.floor(Math.random() * 5) + 1;
            const c = Math.floor(Math.random() * 5) + 2;
            
            currentFractionQuestion = {
                answer: `${a+c}/${b}`,
                expression: `${a}/x + ${c}/x (x=${b})`
            };
            
            document.getElementById('fraction-question').innerHTML = `
                è®¡ç®—åˆ†å¼ï¼ˆå…¶ä¸­ x = ${b}ï¼‰ï¼š<br>
                <div class="formula">${a}/x + ${c}/x</div>
            `;
            
            document.getElementById('fraction-answer').value = '';
            document.getElementById('fraction-result').className = 'result';
            document.getElementById('fraction-result').textContent = '';
            document.getElementById('fraction-hint').style.display = 'none';
        }

        function checkFractionAnswer() {
            const userAnswer = document.getElementById('fraction-answer').value.replace(/\s/g, '');
            const correctAnswer = currentFractionQuestion.answer.replace(/\s/g, '');
            
            const resultDiv = document.getElementById('fraction-result');
            
            if (userAnswer === correctAnswer) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.textContent = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentFractionQuestion.answer}`;
                wrongCount++;
                streak = 0;
                addMistake('åˆ†å¼è¿ç®—', document.getElementById('fraction-question').textContent, userAnswer, currentFractionQuestion.answer);
            }
            
            updateStats();
        }

        function showFractionHint() {
            const hintDiv = document.getElementById('fraction-hint');
            hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>1. åŒåˆ†æ¯åˆ†å¼ç›¸åŠ å‡ï¼Œåˆ†æ¯ä¸å˜ï¼Œåˆ†å­ç›¸åŠ å‡<br>2. åŒ–ç®€ç»“æœ<br>3. ä»£å…¥æ•°å€¼è®¡ç®—`;
            hintDiv.style.display = 'block';
        }

        // å››è¾¹å½¢é¢˜ç›®
        function generateQuadrilateralQuestion() {
            const questions = [
                {
                    question: 'å¹³è¡Œå››è¾¹å½¢çš„å¯¹è§’çº¿ï¼ˆ  ï¼‰',
                    options: ['ç›¸ç­‰', 'äº’ç›¸å¹³åˆ†', 'äº’ç›¸å‚ç›´', 'äº’ç›¸å‚ç›´å¹³åˆ†'],
                    answer: 'äº’ç›¸å¹³åˆ†',
                    hint: 'å¹³è¡Œå››è¾¹å½¢çš„å¯¹è§’çº¿äº’ç›¸å¹³åˆ†'
                },
                {
                    question: 'çŸ©å½¢çš„å¯¹è§’çº¿ï¼ˆ  ï¼‰',
                    options: ['ç›¸ç­‰', 'äº’ç›¸å¹³åˆ†', 'äº’ç›¸å‚ç›´', 'äº’ç›¸å‚ç›´å¹³åˆ†'],
                    answer: 'ç›¸ç­‰',
                    hint: 'çŸ©å½¢çš„å¯¹è§’çº¿ç›¸ç­‰ä¸”äº’ç›¸å¹³åˆ†'
                },
                {
                    question: 'è±å½¢çš„å¯¹è§’çº¿ï¼ˆ  ï¼‰',
                    options: ['ç›¸ç­‰', 'äº’ç›¸å¹³åˆ†', 'äº’ç›¸å‚ç›´', 'äº’ç›¸å‚ç›´å¹³åˆ†'],
                    answer: 'äº’ç›¸å‚ç›´',
                    hint: 'è±å½¢çš„å¯¹è§’çº¿äº’ç›¸å‚ç›´å¹³åˆ†'
                },
                {
                    question: 'æ­£æ–¹å½¢çš„å¯¹è§’çº¿ï¼ˆ  ï¼‰',
                    options: ['ç›¸ç­‰', 'äº’ç›¸å¹³åˆ†', 'äº’ç›¸å‚ç›´', 'äº’ç›¸å‚ç›´å¹³åˆ†'],
                    answer: 'äº’ç›¸å‚ç›´å¹³åˆ†',
                    hint: 'æ­£æ–¹å½¢çš„å¯¹è§’çº¿ç›¸ç­‰ä¸”äº’ç›¸å‚ç›´å¹³åˆ†'
                }
            ];
            
            const q = questions[Math.floor(Math.random() * questions.length)];
            currentQuadrilateralQuestion = q;
            
            document.getElementById('quadrilateral-question').textContent = q.question;
            
            const select = document.getElementById('quadrilateral-answer');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©</option>' + 
                q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
            
            document.getElementById('quadrilateral-result').className = 'result';
            document.getElementById('quadrilateral-result').textContent = '';
            document.getElementById('quadrilateral-hint').style.display = 'none';
        }

        function checkQuadrilateralAnswer() {
            const userAnswer = document.getElementById('quadrilateral-answer').value;
            const correctAnswer = currentQuadrilateralQuestion.answer;
            
            const resultDiv = document.getElementById('quadrilateral-result');
            
            if (userAnswer === correctAnswer) {
                resultDiv.className = 'result correct';
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
                correctCount++;
                streak++;
            } else {
                resultDiv.className = 'result wrong';
                resultDiv.textContent = `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
                wrongCount++;
                streak = 0;
                addMistake('å››è¾¹å½¢', currentQuadrilateralQuestion.question, userAnswer, correctAnswer);
            }
            
            updateStats();
        }

        function showQuadrilateralHint() {
            const hintDiv = document.getElementById('quadrilateral-hint');
            hintDiv.innerHTML = `<strong>æç¤ºï¼š</strong><br>${currentQuadrilateralQuestion.hint}`;
            hintDiv.style.display = 'block';
        }

        // åº†ç¥æ•ˆæœï¼ˆçƒŸèŠ±ï¼‰
        function triggerCelebration() {
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            const celebrationText = document.getElementById('celebration-text');
            
            // æ˜¾ç¤ºCanvas
            canvas.style.display = 'block';
            
            // è®¾ç½®Canvaså°ºå¯¸
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // æ˜¾ç¤ºåº†ç¥æ–‡å­—
            celebrationText.style.display = 'block';
            
            // çƒŸèŠ±ç²’å­æ•°ç»„
            const particles = [];
            const colors = ['#ff0000', '#ff7700', '#ffff00', '#00ff00', '#0077ff', '#ff00ff', '#ff0077'];
            
            // åˆ›å»ºçƒŸèŠ±ç²’å­
            function createFirework(x, y) {
                for (let i = 0; i < 50; i++) {
                    particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 1,
                        decay: Math.random() * 0.02 + 0.01
                    });
                }
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animate() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach((p, index) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // é‡åŠ›
                    p.life -= p.decay;
                    
                    if (p.life <= 0) {
                        particles.splice(index, 1);
                    } else {
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.globalAlpha = p.life;
                        ctx.fill();
                        ctx.globalAlpha = 1;
                    }
                });
                
                if (particles.length > 0) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    canvas.style.display = 'none';
                    celebrationText.style.display = 'none';
                }
            }
            
            // éšæœºä½ç½®å‘å°„çƒŸèŠ±
            let count = 0;
            const maxFireworks = 10;
            const interval = setInterval(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height * 0.6;
                createFirework(x, y);
                
                if (particles.length === 0 || count === 0) {
                    animate();
                }
                
                count++;
                if (count >= maxFireworks) {
                    clearInterval(interval);
                }
            }, 300);
            
            // 5ç§’åéšè—åº†ç¥æ–‡å­—å’ŒCanvas
            setTimeout(() => {
                canvas.style.display = 'none';
                celebrationText.style.display = 'none';
            }, 5000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç»Ÿè®¡æ•°æ®
            const savedStats = localStorage.getItem('mathStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                correctCount = stats.correct || 0;
                wrongCount = stats.wrong || 0;
                streak = stats.streak || 0;
                updateStats();
            }
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é”™é¢˜æœ¬
            const savedMistakes = localStorage.getItem('mathMistakes');
            if (savedMistakes) {
                mistakes = JSON.parse(savedMistakes);
            }
            
            // ç”Ÿæˆç¬¬ä¸€é¢˜
            generateFunctionQuestion();
            generateMovingQuestion();
            generateInequalityQuestion();
            generateFactorizationQuestion();
            generateFractionQuestion();
            generateQuadrilateralQuestion();
        };
    </script>
</body>
</html>
