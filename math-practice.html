<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆäºŒæ•°å­¦å‹è½´é¢˜è®­ç»ƒ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }

        h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs-container {
            margin-bottom: 20px;
        }

        .tabs-row {
            display: flex;
            background: rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 4px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            padding: 10px 12px;
            border-radius: 12px;
            border: none;
            background: transparent;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            display: none;
        }

        .card.active {
            display: block;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .question-type {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        canvas {
            display: block;
            margin: 0 auto 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            touch-action: none;
        }

        .input-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Noto Sans SC', sans-serif;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans SC', sans-serif;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .result {
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            display: none;
        }

        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block;
            animation: bounceIn 0.5s ease;
        }

        .result.wrong {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
            animation: shake 0.5s ease;
        }

        .feedback {
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideIn 0.4s ease;
        }

        .feedback-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .knowledge-section {
            margin: 12px 0;
            padding: 12px;
            background: #f0f4ff;
            border-radius: 8px;
        }

        .knowledge-section h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .knowledge-section p {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
        }

        .tip-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 12px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .tip-box strong {
            color: #856404;
        }

        /* è€ƒè¯•æ¨¡å¼æ ·å¼ */
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
        }

        .exam-timer {
            font-size: 24px;
            font-weight: bold;
        }

        .exam-timer.warning {
            color: #ffc107;
            animation: pulse 1s infinite;
        }

        .exam-timer.danger {
            color: #dc3545;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .exam-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s;
        }

        .exam-container {
            display: none;
        }

        .exam-container.active {
            display: block;
        }

        .exam-question-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
        }

        .question-nav-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .question-nav-btn.current {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .question-nav-btn.answered {
            border-color: #28a745;
            background: #d4edda;
        }

        .question-nav-btn.flagged {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .exam-question-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .exam-question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .exam-question-number {
            font-weight: bold;
            color: #667eea;
        }

        .exam-question-type {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .exam-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .exam-actions .btn {
            flex: 1;
        }

        .report-card {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .report-card.active {
            display: block;
        }

        .report-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .report-score {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .report-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .report-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .report-stat-label {
            font-size: 12px;
            color: #666;
        }

        .weakness-section {
            margin: 20px 0;
        }

        .weakness-item {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .weakness-item h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        .wrong-question {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .wrong-question h4 {
            color: #721c24;
            margin-bottom: 10px;
        }

        .start-exam-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        }

        .start-exam-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40,167,69,0.4);
        }

        @media (max-width: 600px) {
            .report-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .progress-bar {
                width: 120px;
            }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .hint {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
            font-size: 14px;
            display: none;
            line-height: 1.6;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .option {
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #e8edff;
        }

        .option.correct-answer {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.wrong-answer {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .knowledge-point {
            background: #e8f4fd;
            border: 2px solid #2196f3;
            color: #1565c0;
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 600px) {
            .container {
                padding: 16px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .question {
                font-size: 15px;
                padding: 14px;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-value {
                font-size: 20px;
            }

            .tab {
                font-size: 12px;
                padding: 8px 10px;
            }

            .options {
                grid-template-columns: 1fr;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            header {
                padding: 20px 0;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .subtitle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>åˆäºŒæ•°å­¦å‹è½´é¢˜è®­ç»ƒ</h1>
            <div class="subtitle">ç›®æ ‡ï¼šä»105åˆ†æå‡åˆ°115+åˆ† | æ ¹æ®çœŸé¢˜è¯•å·è®¾è®¡</div>
        </header>

        <!-- è€ƒè¯•æ¨¡å¼å…¥å£ -->
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="start-exam-btn" onclick="startExam()">ğŸ“ å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•</button>
        </div>

        <!-- è€ƒè¯•æ¨¡å¼ç•Œé¢ -->
        <div class="exam-container" id="exam-container">
            <div class="exam-header">
                <div class="exam-timer" id="exam-timer">30:00</div>
                <div class="exam-progress">
                    <span id="exam-progress-text">0/12</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="exam-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="exam-question-nav" id="exam-question-nav"></div>
            
            <div class="exam-question-card" id="exam-question-card">
                <div class="exam-question-header">
                    <span class="exam-question-number" id="exam-q-number">ç¬¬ 1 é¢˜</span>
                    <span class="exam-question-type" id="exam-q-type">å‡½æ•°</span>
                </div>
                <div class="question" id="exam-question"></div>
                <canvas id="exam-canvas" width="350" height="280"></canvas>
                <div id="exam-options"></div>
                <div class="input-group" id="exam-input-group" style="display: none;">
                    <label id="exam-input-label">ç­”æ¡ˆ</label>
                    <input type="text" id="exam-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
                </div>
            </div>
            
            <div class="exam-actions">
                <button class="btn btn-secondary" onclick="prevExamQuestion()">ä¸Šä¸€é¢˜</button>
                <button class="btn btn-secondary" onclick="flagExamQuestion()">æ ‡è®°</button>
                <button class="btn btn-primary" onclick="nextExamQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
            <button class="btn" style="background: #dc3545; color: white; margin-top: 10px;" onclick="submitExam()">äº¤å·</button>
        </div>

        <!-- æˆç»©æŠ¥å‘Šç•Œé¢ -->
        <div class="report-card" id="report-card">
            <div class="report-header">
                <h2>ğŸ“Š è€ƒè¯•æˆç»©æŠ¥å‘Š</h2>
                <div class="report-score" id="report-score">0</div>
                <p style="color: #666;">æ»¡åˆ† 100 åˆ†</p>
            </div>
            
            <div class="report-stats">
                <div class="report-stat">
                    <div class="report-stat-value" id="report-correct">0</div>
                    <div class="report-stat-label">ç­”å¯¹</div>
                </div>
                <div class="report-stat">
                    <div class="report-stat-value" id="report-wrong">0</div>
                    <div class="report-stat-label">ç­”é”™</div>
                </div>
                <div class="report-stat">
                    <div class="report-stat-value" id="report-time">0:00</div>
                    <div class="report-stat-label">ç”¨æ—¶</div>
                </div>
                <div class="report-stat">
                    <div class="report-stat-value" id="report-accuracy">0%</div>
                    <div class="report-stat-label">æ­£ç¡®ç‡</div>
                </div>
            </div>
            
            <div class="weakness-section" id="weakness-section">
                <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ¯ è–„å¼±çŸ¥è¯†ç‚¹åˆ†æ</h3>
                <div id="weakness-list"></div>
            </div>
            
            <div id="wrong-questions-section">
                <h3 style="color: #721c24; margin: 20px 0 15px;">âŒ é”™é¢˜è¯¦è§£</h3>
                <div id="wrong-questions-list"></div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="reviewWeakness()">ğŸ“– é’ˆå¯¹æ€§å¤ä¹ </button>
                <button class="btn btn-secondary" onclick="closeReport()">è¿”å›ç»ƒä¹ </button>
            </div>
        </div>

        <div class="tabs-container" id="practice-tabs">
            <div class="tabs-row">
                <button class="tab active" onclick="switchTab('function')">å‡½æ•°å›¾åƒ</button>
                <button class="tab" onclick="switchTab('moving')">åŠ¨ç‚¹é—®é¢˜</button>
                <button class="tab" onclick="switchTab('transform')">åæ ‡å˜æ¢</button>
            </div>
            <div class="tabs-row">
                <button class="tab" onclick="switchTab('quadratic')">äºŒæ¬¡å‡½æ•°</button>
                <button class="tab" onclick="switchTab('equation')">æ–¹ç¨‹æ ¹</button>
                <button class="tab" onclick="switchTab('inequality')">ä¸ç­‰å¼</button>
            </div>
            <div class="tabs-row">
                <button class="tab" onclick="switchTab('probability')">æ¦‚ç‡</button>
                <button class="tab" onclick="switchTab('geometry')">å‡ ä½•è¯æ˜</button>
            </div>
        </div>

        <!-- å‡½æ•°å›¾åƒç»ƒä¹  -->
        <div class="card active" id="function-card">
            <div class="question-type">å‡½æ•°ä¸å›¾åƒ</div>
            <div class="question" id="function-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="function-canvas" width="350" height="350"></canvas>
            
            <div class="input-group">
                <label>å‡½æ•°è§£æå¼ï¼ˆä¾‹å¦‚ï¼šy=2x+1 æˆ– y=6/xï¼‰</label>
                <input type="text" id="function-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            
            <button class="btn btn-primary" onclick="checkFunctionAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showFunctionHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateFunctionQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="function-result"></div>
            <div class="feedback" id="function-feedback"></div>
            <div class="hint" id="function-hint"></div>
        </div>

        <!-- åŠ¨ç‚¹é—®é¢˜ç»ƒä¹  -->
        <div class="card" id="moving-card">
            <div class="question-type">åŠ¨ç‚¹ä¸é¢ç§¯</div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">ç­”å¯¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="wrong-count">0</div>
                    <div class="stat-label">ç­”é”™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">æ­£ç¡®ç‡</div>
                </div>
            </div>

            <div class="question" id="moving-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="moving-canvas" width="350" height="280"></canvas>
            
            <div class="input-group">
                <label>é¢ç§¯ S ä¸æ—¶é—´ t çš„å…³ç³»ï¼ˆä¾‹å¦‚ï¼šS=9tï¼‰</label>
                <input type="text" id="moving-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            
            <button class="btn btn-primary" onclick="checkMovingAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showMovingHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateMovingQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="moving-result"></div>
            <div class="feedback" id="moving-feedback"></div>
            <div class="hint" id="moving-hint"></div>
        </div>

        <!-- åæ ‡å˜æ¢ç»ƒä¹  -->
        <div class="card" id="transform-card">
            <div class="question-type">æ—‹è½¬ä¸å¹³ç§»</div>
            <div class="question" id="transform-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="transform-canvas" width="350" height="350"></canvas>
            
            <div class="input-group">
                <label>å˜æ¢åçš„åæ ‡ï¼ˆä¾‹å¦‚ï¼š(1,-6)ï¼‰</label>
                <input type="text" id="transform-answer" placeholder="è¾“å…¥åæ ‡">
            </div>
            
            <button class="btn btn-primary" onclick="checkTransformAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showTransformHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateTransformQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="transform-result"></div>
            <div class="feedback" id="transform-feedback"></div>
            <div class="hint" id="transform-hint"></div>
        </div>

        <!-- äºŒæ¬¡å‡½æ•°ç»ƒä¹  -->
        <div class="card" id="quadratic-card">
            <div class="question-type">äºŒæ¬¡å‡½æ•°æ€§è´¨</div>
            <div class="question" id="quadratic-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="quadratic-canvas" width="350" height="300"></canvas>
            
            <div class="options" id="quadratic-options"></div>
            
            <button class="btn btn-primary" onclick="checkQuadraticAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showQuadraticHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateQuadraticQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="quadratic-result"></div>
            <div class="feedback" id="quadratic-feedback"></div>
            <div class="hint" id="quadratic-hint"></div>
        </div>

        <!-- æ–¹ç¨‹æ ¹ç»ƒä¹  -->
        <div class="card" id="equation-card">
            <div class="question-type">ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹æ ¹</div>
            <div class="question" id="equation-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <div class="input-group">
                <label>è®¡ç®—ç»“æœï¼ˆå¯ä»¥æ˜¯åˆ†æ•°å¦‚ 5/2ï¼‰</label>
                <input type="text" id="equation-answer" placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ">
            </div>
            
            <button class="btn btn-primary" onclick="checkEquationAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showEquationHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateEquationQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="equation-result"></div>
            <div class="feedback" id="equation-feedback"></div>
            <div class="hint" id="equation-hint"></div>
        </div>

        <!-- ä¸ç­‰å¼ç»ƒä¹  -->
        <div class="card" id="inequality-card">
            <div class="question-type">ä¸ç­‰å¼ç»„æ±‚è§£</div>
            <div class="question" id="inequality-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <div class="input-group">
                <label>è§£é›†ï¼ˆä¾‹å¦‚ï¼š-2&lt;x&lt;3 æˆ– x&gt;5ï¼‰</label>
                <input type="text" id="inequality-answer" placeholder="è¾“å…¥è§£é›†">
            </div>
            
            <button class="btn btn-primary" onclick="checkInequalityAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showInequalityHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateInequalityQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="inequality-result"></div>
            <div class="feedback" id="inequality-feedback"></div>
            <div class="hint" id="inequality-hint"></div>
        </div>

        <!-- æ¦‚ç‡ç»ƒä¹ ï¼ˆæ–°å¢ï¼‰-->
        <div class="card" id="probability-card">
            <div class="question-type">æ¦‚ç‡ä¸ç»Ÿè®¡</div>
            <div class="question" id="probability-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="probability-canvas" width="350" height="200"></canvas>
            
            <div class="input-group">
                <label>æ¦‚ç‡å€¼ï¼ˆä¾‹å¦‚ï¼š2/9 æˆ– 0.5ï¼‰</label>
                <input type="text" id="probability-answer" placeholder="è¾“å…¥æ¦‚ç‡">
            </div>
            
            <button class="btn btn-primary" onclick="checkProbabilityAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showProbabilityHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateProbabilityQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="probability-result"></div>
            <div class="feedback" id="probability-feedback"></div>
            <div class="hint" id="probability-hint"></div>
        </div>

        <!-- å‡ ä½•è¯æ˜ç»ƒä¹ ï¼ˆæ–°å¢ï¼‰-->
        <div class="card" id="geometry-card">
            <div class="question-type">å‡ ä½•è¯æ˜</div>
            <div class="question" id="geometry-question">
                é¢˜ç›®åŠ è½½ä¸­...
            </div>
            
            <canvas id="geometry-canvas" width="350" height="280"></canvas>
            
            <div class="options" id="geometry-options"></div>
            
            <button class="btn btn-primary" onclick="checkGeometryAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showGeometryHint()">æç¤º</button>
            <button class="btn btn-secondary" onclick="generateGeometryQuestion()">ä¸‹ä¸€é¢˜</button>
            
            <div class="result" id="geometry-result"></div>
            <div class="feedback" id="geometry-feedback"></div>
            <div class="hint" id="geometry-hint"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentFunctionQuestion = null;
        let currentMovingQuestion = null;
        let currentTransformQuestion = null;
        let currentQuadraticQuestion = null;
        let currentEquationQuestion = null;
        let currentInequalityQuestion = null;
        let correctCount = 0;
        let wrongCount = 0;

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            const tabNames = ['function', 'moving', 'transform', 'quadratic', 'equation', 'inequality', 'probability', 'geometry'];
            const index = tabNames.indexOf(tab);
            
            if (index !== -1) {
                tabs[index].classList.add('active');
                document.getElementById(`${tab}-card`).classList.add('active');
                
                // ç”Ÿæˆå¯¹åº”é¢˜ç›®
                switch(tab) {
                    case 'function': generateFunctionQuestion(); break;
                    case 'moving': generateMovingQuestion(); break;
                    case 'transform': generateTransformQuestion(); break;
                    case 'quadratic': generateQuadraticQuestion(); break;
                    case 'equation': generateEquationQuestion(); break;
                    case 'inequality': generateInequalityQuestion(); break;
                    case 'probability': generateProbabilityQuestion(); break;
                    case 'geometry': generateGeometryQuestion(); break;
                }
            }
        }

        // ==================== å‡½æ•°å›¾åƒæ¨¡å— ====================
        function generateFunctionQuestion() {
            const types = ['linear', 'inverse'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'linear') {
                const k = (Math.floor(Math.random() * 9) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const b = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                
                currentFunctionQuestion = {
                    type: 'linear',
                    k: k,
                    b: b,
                    answer: `y=${k}x${b >= 0 ? '+' : ''}${b}`,
                    points: []
                };
                
                for (let x = -3; x <= 3; x++) {
                    const y = k * x + b;
                    if (y >= -5 && y <= 5) {
                        currentFunctionQuestion.points.push({x, y});
                    }
                }
                
                document.getElementById('function-question').innerHTML = 
                    `ã€ä¸€æ¬¡å‡½æ•°ã€‘å¦‚å›¾ï¼Œç›´çº¿ç»è¿‡ç‚¹ A(${currentFunctionQuestion.points[0].x}, ${currentFunctionQuestion.points[0].y}) å’Œ B(${currentFunctionQuestion.points[1].x}, ${currentFunctionQuestion.points[1].y})ï¼Œæ±‚è¿™æ¡ç›´çº¿çš„å‡½æ•°è§£æå¼ã€‚`;
                
                drawFunctionGraph();
            } else {
                const k = (Math.floor(Math.random() * 20) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const x0 = Math.floor(Math.random() * 5) + 1;
                const y0 = k / x0;
                
                currentFunctionQuestion = {
                    type: 'inverse',
                    k: k,
                    answer: `y=${k}/x`,
                    points: [{x: x0, y: y0}]
                };
                
                document.getElementById('function-question').innerHTML = 
                    `ã€åæ¯”ä¾‹å‡½æ•°ã€‘å¦‚å›¾ï¼ŒåŒæ›²çº¿ç»è¿‡ç‚¹ A(${x0}, ${y0})ï¼Œæ±‚è¯¥åæ¯”ä¾‹å‡½æ•°çš„è§£æå¼ã€‚`;
                
                drawInverseGraph();
            }
            
            resetResult('function');
        }

        function drawFunctionGraph() {
            const canvas = document.getElementById('function-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            drawAxes(ctx, w, h);
            
            const {k, b} = currentFunctionQuestion;
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = 40; px <= w - 40; px++) {
                const x = (px - w / 2) / 27;
                const y = k * x + b;
                const py = h / 2 - y * 27;
                
                if (py >= 40 && py <= h - 40) {
                    if (px === 40) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            drawPoints(ctx, currentFunctionQuestion.points.slice(0, 2), w, h);
        }

        function drawInverseGraph() {
            const canvas = document.getElementById('function-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            drawAxes(ctx, w, h);
            
            const {k} = currentFunctionQuestion;
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            
            // ç¬¬ä¸€/ä¸‰è±¡é™åˆ†æ”¯
            ctx.beginPath();
            for (let x = 0.1; x <= 5; x += 0.1) {
                const y = k / x;
                if (y >= -5 && y <= 5) {
                    const px = w / 2 + x * 27;
                    const py = h / 2 - y * 27;
                    if (x === 0.1) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            ctx.beginPath();
            for (let x = -5; x <= -0.1; x += 0.1) {
                const y = k / x;
                if (y >= -5 && y <= 5) {
                    const px = w / 2 + x * 27;
                    const py = h / 2 - y * 27;
                    if (x === -5) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            drawPoints(ctx, currentFunctionQuestion.points, w, h);
        }

        function checkFunctionAnswer() {
            const userAnswer = document.getElementById('function-answer').value.replace(/\s/g, '');
            const correctAnswer = currentFunctionQuestion.answer.replace(/\s/g, '');
            
            const isCorrect = userAnswer === correctAnswer || 
                userAnswer.replace(/y=/, '') === correctAnswer.replace(/y=/, '') ||
                simplifyAnswer(userAnswer) === simplifyAnswer(correctAnswer);
            
            showResult('function', isCorrect, currentFunctionQuestion.answer);
            updateStats(isCorrect);
        }

        function showFunctionHint() {
            const hintDiv = document.getElementById('function-hint');
            if (currentFunctionQuestion.type === 'linear') {
                hintDiv.innerHTML = `<strong>è§£é¢˜æ­¥éª¤ï¼š</strong><br>
                    1. è®¾å‡½æ•°è§£æå¼ä¸º y = kx + b<br>
                    2. å°†ç‚¹ A å’Œç‚¹ B çš„åæ ‡åˆ†åˆ«ä»£å…¥<br>
                    3. è§£æ–¹ç¨‹ç»„æ±‚å‡º k å’Œ b<br>
                    <strong>æŠ€å·§ï¼š</strong>å…ˆç”¨ä¸¤ç‚¹å¼æ±‚æ–œç‡ k = (yâ‚‚-yâ‚)/(xâ‚‚-xâ‚)`;
            } else {
                hintDiv.innerHTML = `<strong>è§£é¢˜æ­¥éª¤ï¼š</strong><br>
                    1. è®¾åæ¯”ä¾‹å‡½æ•° y = k/x<br>
                    2. å°†ç‚¹åæ ‡ä»£å…¥ï¼šyâ‚€ = k/xâ‚€<br>
                    3. æ±‚å‡º k = xâ‚€ Ã— yâ‚€<br>
                    <strong>æŠ€å·§ï¼š</strong>k = æ¨ªåæ ‡ Ã— çºµåæ ‡`;
            }
            hintDiv.style.display = 'block';
        }

        // ==================== åŠ¨ç‚¹é—®é¢˜æ¨¡å— ====================
        function generateMovingQuestion() {
            const width = Math.floor(Math.random() * 4) + 6;
            const height = Math.floor(Math.random() * 4) + 6;
            const pSpeed = Math.floor(Math.random() * 3) + 1;
            const qSpeed = Math.floor(Math.random() * 3) + 1;
            
            currentMovingQuestion = {
                width, height, pSpeed, qSpeed,
                answer: `S=${width * qSpeed / 2}t`,
                maxTime: Math.min(height / pSpeed, width / qSpeed)
            };
            
            document.getElementById('moving-question').innerHTML = `
                ã€çŸ©å½¢åŠ¨ç‚¹ã€‘å¦‚å›¾ï¼Œåœ¨çŸ©å½¢ ABCD ä¸­ï¼ŒAB = ${width}ï¼ŒBC = ${height}ã€‚<br>
                ç‚¹ P ä»ç‚¹ A å‡ºå‘ï¼Œä»¥æ¯ç§’ ${pSpeed} ä¸ªå•ä½æ²¿ AD å‘ D è¿åŠ¨ï¼›<br>
                ç‚¹ Q ä»ç‚¹ B å‡ºå‘ï¼Œä»¥æ¯ç§’ ${qSpeed} ä¸ªå•ä½æ²¿ BC å‘ C è¿åŠ¨ã€‚<br>
                ä¸¤ç‚¹åŒæ—¶å‡ºå‘ï¼Œè®¾è¿åŠ¨ t ç§’å â–³PBQ çš„é¢ç§¯ä¸º Sï¼Œæ±‚ S ä¸ t çš„å…³ç³»å¼ã€‚`;
            
            drawMovingGraph();
            resetResult('moving');
        }

        function drawMovingGraph() {
            const canvas = document.getElementById('moving-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const {width, height, pSpeed, qSpeed} = currentMovingQuestion;
            const scale = Math.min((w - 80) / width, (h - 80) / height);
            const offsetX = (w - width * scale) / 2;
            const offsetY = (h - height * scale) / 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.strokeRect(offsetX, offsetY, width * scale, height * scale);
            
            ctx.fillStyle = '#333';
            ctx.font = '16px Noto Sans SC';
            ctx.textAlign = 'center';
            
            const points = {
                A: {x: offsetX, y: offsetY + height * scale},
                B: {x: offsetX + width * scale, y: offsetY + height * scale},
                C: {x: offsetX + width * scale, y: offsetY},
                D: {x: offsetX, y: offsetY}
            };
            
            ctx.fillText('A', points.A.x - 20, points.A.y + 5);
            ctx.fillText('B', points.B.x + 20, points.B.y + 5);
            ctx.fillText('C', points.C.x + 20, points.C.y + 5);
            ctx.fillText('D', points.D.x - 20, points.D.y + 5);
            
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText(`AB = ${width}`, (points.A.x + points.B.x) / 2, points.A.y + 30);
            ctx.fillText(`BC = ${height}`, points.B.x + 30, (points.B.y + points.C.y) / 2);
            
            // è¿åŠ¨æ–¹å‘
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(points.A.x, points.A.y - 20);
            ctx.lineTo(points.A.x, points.A.y - height * scale + 20);
            ctx.stroke();
            drawArrow(ctx, points.A.x, points.A.y - height * scale + 20, 'up');
            
            ctx.beginPath();
            ctx.moveTo(points.B.x, points.B.y - 20);
            ctx.lineTo(points.B.x, points.B.y - height * scale + 20);
            ctx.stroke();
            drawArrow(ctx, points.B.x, points.B.y - height * scale + 20, 'up');
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '12px Noto Sans SC';
            ctx.fillText(`v=${pSpeed}`, points.A.x - 35, points.A.y - height * scale / 2);
            ctx.fillText(`v=${qSpeed}`, points.B.x + 35, points.B.y - height * scale / 2);
            
            ctx.fillStyle = '#764ba2';
            ctx.beginPath();
            ctx.arc(points.A.x, points.A.y - height * scale / 3, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('P', points.A.x - 15, points.A.y - height * scale / 3 + 5);
            
            ctx.beginPath();
            ctx.arc(points.B.x, points.B.y - height * scale / 3, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('Q', points.B.x + 15, points.B.y - height * scale / 3 + 5);
        }

        function checkMovingAnswer() {
            const userAnswer = document.getElementById('moving-answer').value.replace(/\s/g, '');
            const correctAnswer = currentMovingQuestion.answer.replace(/\s/g, '');
            
            const isCorrect = userAnswer === correctAnswer || 
                userAnswer.replace(/S=/, '') === correctAnswer.replace(/S=/, '');
            
            showResult('moving', isCorrect, currentMovingQuestion.answer + ` (0 â‰¤ t â‰¤ ${currentMovingQuestion.maxTime.toFixed(1)})`);
            updateStats(isCorrect);
        }

        function showMovingHint() {
            const {width, pSpeed, qSpeed} = currentMovingQuestion;
            document.getElementById('moving-hint').innerHTML = `
                <strong>è§£é¢˜æ€è·¯ï¼š</strong><br>
                1. â–³PBQ çš„é¢ç§¯ = Â½ Ã— åº• Ã— é«˜ = Â½ Ã— PB Ã— BQ<br>
                2. PB = AB = ${width}ï¼ˆä¸å˜ï¼‰<br>
                3. BQ = ${qSpeed}tï¼ˆQ ç‚¹ç§»åŠ¨çš„è·ç¦»ï¼‰<br>
                4. S = Â½ Ã— ${width} Ã— ${qSpeed}t = ${width * qSpeed / 2}t<br>
                <strong>æ³¨æ„ï¼š</strong>ç¡®å®š t çš„å–å€¼èŒƒå›´`;
            document.getElementById('moving-hint').style.display = 'block';
        }

        // ==================== åæ ‡å˜æ¢æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        function generateTransformQuestion() {
            const types = ['rotate', 'translate'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            // åŸå§‹ç‚¹
            const x = Math.floor(Math.random() * 5) + 1;
            const y = Math.floor(Math.random() * 5) + 1;
            
            if (type === 'rotate') {
                // ç»•åŸç‚¹é€†æ—¶é’ˆæ—‹è½¬90åº¦ï¼š(x, y) â†’ (-y, x)
                currentTransformQuestion = {
                    type: 'rotate',
                    original: {x, y},
                    answer: `(${-y},${x})`,
                    steps: ['ç»•åŸç‚¹é€†æ—¶é’ˆæ—‹è½¬90Â°', '(x, y) â†’ (-y, x)']
                };
                
                document.getElementById('transform-question').innerHTML = `
                    ã€åæ ‡æ—‹è½¬ã€‘å¦‚å›¾ï¼Œç‚¹ A çš„åæ ‡æ˜¯ (${x}, ${y})ã€‚<br>
                    å°†ç‚¹ A ç»•åŸç‚¹ O é€†æ—¶é’ˆæ—‹è½¬ 90Â° å¾—åˆ°ç‚¹ A'ï¼Œæ±‚ç‚¹ A' çš„åæ ‡ã€‚`;
            } else {
                // å¹³ç§»ï¼šå‘ä¸‹å¹³ç§» n ä¸ªå•ä½
                const n = Math.floor(Math.random() * 4) + 2;
                currentTransformQuestion = {
                    type: 'translate',
                    original: {x, y},
                    translateY: -n,
                    answer: `(${x},${y - n})`,
                    steps: [`å‘ä¸‹å¹³ç§» ${n} ä¸ªå•ä½`, 'y åæ ‡å‡ n']
                };
                
                document.getElementById('transform-question').innerHTML = `
                    ã€åæ ‡å¹³ç§»ã€‘å¦‚å›¾ï¼Œç‚¹ A çš„åæ ‡æ˜¯ (${x}, ${y})ã€‚<br>
                    å°†ç‚¹ A å‘ä¸‹å¹³ç§» ${n} ä¸ªå•ä½å¾—åˆ°ç‚¹ A'ï¼Œæ±‚ç‚¹ A' çš„åæ ‡ã€‚`;
            }
            
            drawTransformGraph();
            resetResult('transform');
        }

        function drawTransformGraph() {
            const canvas = document.getElementById('transform-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            drawAxes(ctx, w, h);
            
            const {original} = currentTransformQuestion;
            const px1 = w / 2 + original.x * 27;
            const py1 = h / 2 - original.y * 27;
            
            // åŸç‚¹
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('O', w / 2 - 15, h / 2 + 15);
            
            // åŸå§‹ç‚¹ A
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(px1, py1, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText(`A(${original.x},${original.y})`, px1 + 10, py1 - 10);
            
            // å˜æ¢åçš„ç‚¹
            let newPx, newPy, newCoord;
            if (currentTransformQuestion.type === 'rotate') {
                newCoord = `(${-original.y},${original.x})`;
                newPx = w / 2 + (-original.y) * 27;
                newPy = h / 2 - original.x * 27;
            } else {
                const n = -currentTransformQuestion.translateY;
                newCoord = `(${original.x},${original.y - n})`;
                newPx = px1;
                newPy = h / 2 - (original.y - n) * 27;
            }
            
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(newPx, newPy, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText(`A'`, newPx + 10, newPy - 10);
            
            // ç»˜åˆ¶å˜æ¢è·¯å¾„
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(px1, py1);
            ctx.lineTo(newPx, newPy);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function checkTransformAnswer() {
            const userAnswer = document.getElementById('transform-answer').value.replace(/\s/g, '').replace(/\(/g, '').replace(/\)/g, '');
            const correctAnswer = currentTransformQuestion.answer.replace(/\s/g, '').replace(/\(/g, '').replace(/\)/g, '');
            
            const isCorrect = userAnswer === correctAnswer;
            
            showResult('transform', isCorrect, currentTransformQuestion.answer);
            updateStats(isCorrect);
        }

        function showTransformHint() {
            const hintDiv = document.getElementById('transform-hint');
            if (currentTransformQuestion.type === 'rotate') {
                hintDiv.innerHTML = `
                    <strong>æ—‹è½¬è§„å¾‹ï¼š</strong><br>
                    ç»•åŸç‚¹é€†æ—¶é’ˆæ—‹è½¬ 90Â°ï¼š<br>
                    (x, y) â†’ (-y, x)<br><br>
                    <strong>è®°å¿†å£è¯€ï¼š</strong><br>
                    "x å˜ y çš„è´Ÿï¼Œy å˜ x çš„æ­£"<br><br>
                    <strong>æ¨å¹¿ï¼š</strong><br>
                    æ—‹è½¬ 180Â°ï¼š(x, y) â†’ (-x, -y)<br>
                    æ—‹è½¬ 270Â°ï¼š(x, y) â†’ (y, -x)`;
            } else {
                hintDiv.innerHTML = `
                    <strong>å¹³ç§»è§„å¾‹ï¼š</strong><br>
                    å‘å³å¹³ç§» a ä¸ªå•ä½ï¼š(x, y) â†’ (x+a, y)<br>
                    å‘å·¦å¹³ç§» a ä¸ªå•ä½ï¼š(x, y) â†’ (x-a, y)<br>
                    å‘ä¸Šå¹³ç§» b ä¸ªå•ä½ï¼š(x, y) â†’ (x, y+b)<br>
                    å‘ä¸‹å¹³ç§» b ä¸ªå•ä½ï¼š(x, y) â†’ (x, y-b)<br><br>
                    <strong>è®°å¿†ï¼š</strong>"å·¦å‡å³åŠ ï¼Œä¸ŠåŠ ä¸‹å‡"`;
            }
            hintDiv.style.display = 'block';
        }

        // ==================== äºŒæ¬¡å‡½æ•°æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        function generateQuadraticQuestion() {
            // éšæœºç”ŸæˆäºŒæ¬¡å‡½æ•° y = axÂ² + bx + c çš„å‚æ•°
            const a = Math.random() > 0.5 ? 1 : -1;
            const vertexX = Math.floor(Math.random() * 5) - 2; // -2 åˆ° 2
            const c = Math.floor(Math.random() * 5) - 2; // y è½´æˆªè·
            
            // æ ¹æ®é¡¶ç‚¹å¼ y = a(x-h)Â² + kï¼Œè½¬åŒ–ä¸ºä¸€èˆ¬å¼
            // é¡¶ç‚¹ (h, k)ï¼Œè¿™é‡Œ h = vertexX
            const k = a * (0 - vertexX) * (0 - vertexX) + c; // é¡¶ç‚¹ y åæ ‡
            const b = -2 * a * vertexX; // å±•å¼€ axÂ² - 2ahx + ahÂ² + k
            
            currentQuadraticQuestion = {
                a, b, c,
                vertexX,
                vertexY: k,
                answer: Math.floor(Math.random() * 5) + 1 // æ­£ç¡®ç»“è®ºç¼–å·
            };
            
            // ç”Ÿæˆé¢˜ç›®
            const questions = [
                {
                    text: `ã€äºŒæ¬¡å‡½æ•°æ€§è´¨ã€‘å¦‚å›¾ï¼ŒäºŒæ¬¡å‡½æ•° y = ${a}xÂ² ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} çš„å›¾åƒã€‚<br>
                        å¯¹ç§°è½´ä¸º x = ${vertexX}ï¼Œä¸ y è½´äº¤äºç‚¹ (0, ${c})ã€‚<br><br>
                        ä¸‹åˆ—ç»“è®ºæ­£ç¡®çš„æ˜¯ï¼š`,
                    options: [
                        `abc > 0`,
                        `bÂ² - 4ac > 0`,
                        `a + b + c > 0`,
                        `å½“ x > ${vertexX} æ—¶ï¼Œy éš x å¢å¤§è€Œ${a > 0 ? 'å¢å¤§' : 'å‡å°'}`
                    ],
                    correct: a > 0 ? 2 : 3
                },
                {
                    text: `ã€äºŒæ¬¡å‡½æ•°å›¾åƒã€‘äºŒæ¬¡å‡½æ•° y = axÂ² + bx + c çš„å›¾åƒå¦‚å›¾æ‰€ç¤ºã€‚<br>
                        å¯¹ç§°è½´æ˜¯ç›´çº¿ x = 1ï¼Œä¸ x è½´çš„ä¸€ä¸ªäº¤ç‚¹æ˜¯ (3, 0)ã€‚<br><br>
                        ä¸‹åˆ—ç»“è®ºä¸­ï¼Œæ­£ç¡®çš„ä¸ªæ•°æ˜¯ï¼š<br>
                        â‘  abc < 0  â‘¡ b = 2a  â‘¢ 4a + 2b + c > 0`,
                    options: [`0ä¸ª`, `1ä¸ª`, `2ä¸ª`, `3ä¸ª`],
                    correct: 2
                }
            ];
            
            const q = questions[Math.floor(Math.random() * questions.length)];
            currentQuadraticQuestion.correct = q.correct;
            currentQuadraticQuestion.options = q.options;
            
            document.getElementById('quadratic-question').innerHTML = q.text;
            
            // ç”Ÿæˆé€‰é¡¹
            const optionsDiv = document.getElementById('quadratic-options');
            optionsDiv.innerHTML = q.options.map((opt, i) => 
                `<div class="option" onclick="selectQuadraticOption(${i})" id="q-opt-${i}">${String.fromCharCode(65 + i)}. ${opt}</div>`
            ).join('');
            
            drawQuadraticGraph();
            resetResult('quadratic');
            selectedQuadraticOption = -1;
            
            // é‡ç½®é€‰é¡¹æ ·å¼
            document.querySelectorAll('#quadratic-options .option').forEach(opt => {
                opt.classList.remove('selected', 'correct-answer', 'wrong-answer');
            });
        }

        function drawQuadraticGraph() {
            const canvas = document.getElementById('quadratic-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            drawAxes(ctx, w, h);
            
            // ç»˜åˆ¶ä¸€ä¸ªç¤ºä¾‹æŠ›ç‰©çº¿
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = 40; px <= w - 40; px++) {
                const x = (px - w / 2) / 30;
                const y = x * x - 2; // ç¤ºä¾‹æŠ›ç‰©çº¿
                const py = h / 2 - y * 25;
                
                if (py >= 40 && py <= h - 40) {
                    if (px === 40) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            // æ ‡è®°å¯¹ç§°è½´
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(w / 2, 40);
            ctx.lineTo(w / 2, h - 40);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '12px Noto Sans SC';
            ctx.fillText('å¯¹ç§°è½´', w / 2 + 10, 60);
        }

        let selectedQuadraticOption = -1;
        
        function selectQuadraticOption(index) {
            selectedQuadraticOption = index;
            document.querySelectorAll('#quadratic-options .option').forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) opt.classList.add('selected');
            });
        }

        function checkQuadraticAnswer() {
            if (selectedQuadraticOption === -1) {
                document.getElementById('quadratic-result').className = 'result wrong';
                document.getElementById('quadratic-result').textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼';
                return;
            }
            
            const isCorrect = selectedQuadraticOption === currentQuadraticQuestion.correct;
            const correctText = currentQuadraticQuestion.options[currentQuadraticQuestion.correct];
            
            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            document.querySelectorAll('#quadratic-options .option').forEach((opt, i) => {
                if (i === currentQuadraticQuestion.correct) {
                    opt.classList.add('correct-answer');
                } else if (i === selectedQuadraticOption && !isCorrect) {
                    opt.classList.add('wrong-answer');
                }
            });
            
            showResult('quadratic', isCorrect, String.fromCharCode(65 + currentQuadraticQuestion.correct) + '. ' + correctText);
            updateStats(isCorrect);
            selectedQuadraticOption = -1;
        }

        function showQuadraticHint() {
            document.getElementById('quadratic-hint').innerHTML = `
                <strong>äºŒæ¬¡å‡½æ•°å…³é”®æ€§è´¨ï¼š</strong><br>
                1. å¼€å£æ–¹å‘ï¼ša > 0 å‘ä¸Šï¼Œa < 0 å‘ä¸‹<br>
                2. å¯¹ç§°è½´ï¼šx = -b/(2a)<br>
                3. é¡¶ç‚¹åæ ‡ï¼š(-b/(2a), (4ac-bÂ²)/(4a))<br>
                4. ä¸ y è½´äº¤ç‚¹ï¼š(0, c)<br>
                5. åˆ¤åˆ«å¼ Î” = bÂ² - 4acï¼š<br>
                   &nbsp;&nbsp;â€¢ Î” > 0ï¼šä¸ x è½´æœ‰ä¸¤ä¸ªäº¤ç‚¹<br>
                   &nbsp;&nbsp;â€¢ Î” = 0ï¼šä¸ x è½´æœ‰ä¸€ä¸ªäº¤ç‚¹<br>
                   &nbsp;&nbsp;â€¢ Î” < 0ï¼šä¸ x è½´æ— äº¤ç‚¹<br><br>
                <strong>æŠ€å·§ï¼š</strong><br>
                â€¢ çœ‹ a çš„ç¬¦å·åˆ¤æ–­å¼€å£<br>
                â€¢ çœ‹ c çš„ç¬¦å·åˆ¤æ–­ y æˆªè·<br>
                â€¢ ç”¨å¯¹ç§°è½´å…¬å¼åˆ¤æ–­ b ä¸ a çš„å…³ç³»`;
            document.getElementById('quadratic-hint').style.display = 'block';
        }

        // ==================== æ–¹ç¨‹æ ¹æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        function generateEquationQuestion() {
            const types = ['vieta_sum', 'vieta_product', 'expression'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            // ç”Ÿæˆä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ xÂ² + bx + c = 0
            const x1 = Math.floor(Math.random() * 9) + 1;
            const x2 = Math.floor(Math.random() * 9) + 1;
            const b = -(x1 + x2);
            const c = x1 * x2;
            
            if (type === 'vieta_sum') {
                currentEquationQuestion = {
                    type: 'vieta_sum',
                    equation: `xÂ² ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                    answer: `${x1 + x2}`,
                    x1, x2
                };
                
                document.getElementById('equation-question').innerHTML = `
                    ã€æ ¹ä¸ç³»æ•°ã€‘è‹¥ xâ‚ã€xâ‚‚ æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ ${currentEquationQuestion.equation} çš„ä¸¤æ ¹ï¼Œ<br>
                    åˆ™ xâ‚ + xâ‚‚ çš„å€¼æ˜¯______ã€‚`;
            } else if (type === 'vieta_product') {
                currentEquationQuestion = {
                    type: 'vieta_product',
                    equation: `xÂ² ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                    answer: `${x1 * x2}`,
                    x1, x2
                };
                
                document.getElementById('equation-question').innerHTML = `
                    ã€æ ¹ä¸ç³»æ•°ã€‘è‹¥ xâ‚ã€xâ‚‚ æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ ${currentEquationQuestion.equation} çš„ä¸¤æ ¹ï¼Œ<br>
                    åˆ™ xâ‚ Â· xâ‚‚ çš„å€¼æ˜¯______ã€‚`;
            } else {
                // è¡¨è¾¾å¼æ±‚å€¼ï¼šå¦‚ (xâ‚ - 2)(xâ‚‚ - 2)
                currentEquationQuestion = {
                    type: 'expression',
                    equation: `xÂ² - 7x + 5 = 0`,
                    expression: '(xâ‚ - 2)(xâ‚‚ - 2)',
                    answer: `${x1 * x2 - 2 * (x1 + x2) + 4}`,
                    // ä½¿ç”¨å›ºå®šçš„æ–¹ç¨‹
                    sum: 7,
                    product: 5
                };
                
                // é‡æ–°è®¡ç®—
                const sum = 7, product = 5;
                const result = product - 2 * sum + 4;
                
                currentEquationQuestion = {
                    type: 'expression',
                    equation: `xÂ² - 7x + 5 = 0`,
                    expression: '(xâ‚ - 2)(xâ‚‚ - 2)',
                    answer: `${result}`,
                    sum, product
                };
                
                document.getElementById('equation-question').innerHTML = `
                    ã€æ ¹ä¸ç³»æ•°ã€‘è‹¥ xâ‚ã€xâ‚‚ æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ ${currentEquationQuestion.equation} çš„ä¸¤æ ¹ï¼Œ<br>
                    åˆ™ (xâ‚ - 2)(xâ‚‚ - 2) çš„å€¼æ˜¯______ã€‚`;
            }
            
            resetResult('equation');
        }

        function checkEquationAnswer() {
            const userAnswer = document.getElementById('equation-answer').value.replace(/\s/g, '');
            const correctAnswer = currentEquationQuestion.answer;
            
            const isCorrect = userAnswer === correctAnswer;
            
            showResult('equation', isCorrect, currentEquationQuestion.answer);
            updateStats(isCorrect);
        }

        function showEquationHint() {
            const hintDiv = document.getElementById('equation-hint');
            
            if (currentEquationQuestion.type === 'vieta_sum') {
                hintDiv.innerHTML = `
                    <strong>éŸ¦è¾¾å®šç†ï¼š</strong><br>
                    å¯¹äºæ–¹ç¨‹ axÂ² + bx + c = 0 (a â‰  0)ï¼š<br>
                    xâ‚ + xâ‚‚ = -b/a<br>
                    xâ‚ Â· xâ‚‚ = c/a<br><br>
                    <strong>æœ¬é¢˜ï¼š</strong><br>
                    æ–¹ç¨‹æ˜¯ xÂ² + bx + c = 0<br>
                    æ‰€ä»¥ xâ‚ + xâ‚‚ = -b`;
            } else if (currentEquationQuestion.type === 'vieta_product') {
                hintDiv.innerHTML = `
                    <strong>éŸ¦è¾¾å®šç†ï¼š</strong><br>
                    å¯¹äºæ–¹ç¨‹ axÂ² + bx + c = 0 (a â‰  0)ï¼š<br>
                    xâ‚ + xâ‚‚ = -b/a<br>
                    xâ‚ Â· xâ‚‚ = c/a<br><br>
                    <strong>æœ¬é¢˜ï¼š</strong><br>
                    æ–¹ç¨‹æ˜¯ xÂ² + bx + c = 0<br>
                    æ‰€ä»¥ xâ‚ Â· xâ‚‚ = c`;
            } else {
                hintDiv.innerHTML = `
                    <strong>å±•å¼€å¹¶åˆ©ç”¨éŸ¦è¾¾å®šç†ï¼š</strong><br>
                    (xâ‚ - 2)(xâ‚‚ - 2)<br>
                    = xâ‚xâ‚‚ - 2xâ‚ - 2xâ‚‚ + 4<br>
                    = xâ‚xâ‚‚ - 2(xâ‚ + xâ‚‚) + 4<br><br>
                    <strong>ä»£å…¥éŸ¦è¾¾å®šç†ï¼š</strong><br>
                    xâ‚ + xâ‚‚ = 7<br>
                    xâ‚ Â· xâ‚‚ = 5<br><br>
                    åŸå¼ = 5 - 2Ã—7 + 4 = -5<br><br>
                    <strong>æŠ€å·§ï¼š</strong>å°†è¡¨è¾¾å¼å±•å¼€ä¸º xâ‚+xâ‚‚ å’Œ xâ‚Â·xâ‚‚ çš„ç»„åˆ`;
            }
            hintDiv.style.display = 'block';
        }

        // ==================== ä¸ç­‰å¼æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        function generateInequalityQuestion() {
            // éšæœºç”Ÿæˆä¸ç­‰å¼ç»„
            const a1 = Math.floor(Math.random() * 5) + 1;
            const b1 = Math.floor(Math.random() * 10) - 5;
            const c1 = a1 * 2 + b1; // è§£ä¸º x > 2
            
            const a2 = Math.floor(Math.random() * 5) + 1;
            const b2 = Math.floor(Math.random() * 10) - 5;
            const c2 = a2 * 5 + b2; // è§£ä¸º x < 5
            
            currentInequalityQuestion = {
                ineq1: `${a1}x ${b1 >= 0 ? '+' : ''}${b1} > ${c1}`,
                ineq2: `${a2}x ${b2 >= 0 ? '+' : ''}${b2} < ${c2}`,
                answer: '2<x<5',
                sol1: 2,
                sol2: 5
            };
            
            document.getElementById('inequality-question').innerHTML = `
                ã€ä¸ç­‰å¼ç»„æ±‚è§£ã€‘è§£ä¸ç­‰å¼ç»„ï¼š<br>
                <div style="margin: 15px 0; padding: 10px; background: #f0f4ff; border-radius: 8px;">
                { ${a1}x ${b1 >= 0 ? '+' : ''}${b1} > ${c1}<br>
                &nbsp;&nbsp;${a2}x ${b2 >= 0 ? '+' : ''}${b2} < ${c2}
                </div>
                å¹¶å†™å‡ºè§£é›†ã€‚`;
            
            resetResult('inequality');
        }

        function checkInequalityAnswer() {
            const userAnswer = document.getElementById('inequality-answer').value.replace(/\s/g, '');
            const correctAnswer = currentInequalityQuestion.answer;
            
            // å¤šç§ç­”æ¡ˆæ ¼å¼
            const correctFormats = [
                correctAnswer,
                '2<x<5',
                '5>x>2',
                '(2,5)',
                'x>2ä¸”x<5'
            ];
            
            const isCorrect = correctFormats.includes(userAnswer);
            
            showResult('inequality', isCorrect, currentInequalityQuestion.answer);
            updateStats(isCorrect);
        }

        function showInequalityHint() {
            document.getElementById('inequality-hint').innerHTML = `
                <strong>è§£é¢˜æ­¥éª¤ï¼š</strong><br>
                1. åˆ†åˆ«è§£ä¸¤ä¸ªä¸ç­‰å¼<br>
                2. æ‰¾å‡ºä¸¤ä¸ªè§£é›†çš„å…¬å…±éƒ¨åˆ†<br><br>
                <strong>å£è¯€ï¼š</strong><br>
                "åŒå¤§å–å¤§ï¼ŒåŒå°å–å°<br>
                å¤§å°å°å¤§ä¸­é—´æ‰¾<br>
                å¤§å¤§å°å°æ‰¾ä¸åˆ°"<br><br>
                <strong>ç¤ºä¾‹ï¼š</strong><br>
                x > 2 ä¸” x < 5 â†’ 2 < x < 5<br>
                x > 3 ä¸” x > 1 â†’ x > 3<br>
                x < 2 ä¸” x > 5 â†’ æ— è§£`;
            document.getElementById('inequality-hint').style.display = 'block';
        }

        // ==================== è¾…åŠ©å‡½æ•° ====================
        function drawAxes(ctx, w, h) {
            const padding = 40;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // x è½´
            ctx.beginPath();
            ctx.moveTo(padding, h / 2);
            ctx.lineTo(w - padding, h / 2);
            ctx.stroke();
            
            // y è½´
            ctx.beginPath();
            ctx.moveTo(w / 2, padding);
            ctx.lineTo(w / 2, h - padding);
            ctx.stroke();
            
            // åˆ»åº¦å’Œæ•°å­—
            ctx.fillStyle = '#666';
            ctx.font = '12px Noto Sans SC';
            ctx.textAlign = 'center';
            
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const x = w / 2 + i * 27;
                    ctx.beginPath();
                    ctx.moveTo(x, h / 2 - 5);
                    ctx.lineTo(x, h / 2 + 5);
                    ctx.stroke();
                    ctx.fillText(i.toString(), x, h / 2 + 20);
                }
            }
            
            ctx.textAlign = 'right';
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    const y = h / 2 - i * 27;
                    ctx.beginPath();
                    ctx.moveTo(w / 2 - 5, y);
                    ctx.lineTo(w / 2 + 5, y);
                    ctx.stroke();
                    ctx.fillText(i.toString(), w / 2 - 10, y + 4);
                }
            }
        }

        function drawPoints(ctx, points, w, h) {
            ctx.fillStyle = '#764ba2';
            points.forEach((point, i) => {
                const px = w / 2 + point.x * 27;
                const py = h / 2 - point.y * 27;
                
                ctx.beginPath();
                ctx.arc(px, py, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#333';
                ctx.font = '14px Noto Sans SC';
                ctx.fillText(i === 0 ? 'A' : 'B', px + 10, py - 10);
                ctx.fillStyle = '#764ba2';
            });
        }

        function drawArrow(ctx, x, y, direction) {
            ctx.beginPath();
            if (direction === 'up') {
                ctx.moveTo(x - 6, y + 10);
                ctx.lineTo(x, y);
                ctx.lineTo(x + 6, y + 10);
            }
            ctx.stroke();
        }

        function showResult(type, isCorrect, correctAnswer) {
            const resultDiv = document.getElementById(`${type}-result`);
            resultDiv.className = 'result ' + (isCorrect ? 'correct' : 'wrong');
            resultDiv.textContent = isCorrect ? 'âœ“ å›ç­”æ­£ç¡®ï¼' : `âœ— ç­”æ¡ˆé”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
            
            // å¦‚æœé”™è¯¯ï¼Œæ˜¾ç¤ºçŸ¥è¯†ç‚¹è®²è§£
            if (!isCorrect) {
                showFeedback(type);
            } else {
                document.getElementById(`${type}-feedback`).classList.remove('show');
            }
        }

        // æ˜¾ç¤ºè¯¦ç»†çŸ¥è¯†ç‚¹è®²è§£
        function showFeedback(type) {
            const feedbackDiv = document.getElementById(`${type}-feedback`);
            let content = '';
            
            switch(type) {
                case 'function':
                    content = getFunctionFeedback();
                    break;
                case 'moving':
                    content = getMovingFeedback();
                    break;
                case 'transform':
                    content = getTransformFeedback();
                    break;
                case 'quadratic':
                    content = getQuadraticFeedback();
                    break;
                case 'equation':
                    content = getEquationFeedback();
                    break;
                case 'inequality':
                    content = getInequalityFeedback();
                    break;
                case 'probability':
                    content = getProbabilityFeedback();
                    break;
                case 'geometry':
                    content = getGeometryFeedback();
                    break;
            }
            
            feedbackDiv.innerHTML = content;
            feedbackDiv.classList.add('show');
        }

        // å‡½æ•°å›¾åƒçŸ¥è¯†ç‚¹è®²è§£
        function getFunctionFeedback() {
            if (currentFunctionQuestion.type === 'linear') {
                return `
                    <div class="feedback-title">ğŸ“š ä¸€æ¬¡å‡½æ•°çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>ä¸€æ¬¡å‡½æ•°è¡¨è¾¾å¼ï¼š</strong>y = kx + b</p>
                        <p>â€¢ k å«åšæ–œç‡ï¼ˆå†³å®šç›´çº¿çš„å€¾æ–œç¨‹åº¦ï¼‰</p>
                        <p>â€¢ b å«åšæˆªè·ï¼ˆç›´çº¿ä¸yè½´çš„äº¤ç‚¹ï¼‰</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æƒ³è±¡ä½ åœ¨ç”»ä¸€æ¡ç›´çº¿ï¼š</p>
                        <p>â€¢ <strong>k</strong> å°±åƒå¡åº¦ï¼Œk è¶Šå¤§å¡è¶Šé™¡</p>
                        <p>â€¢ <strong>b</strong> å°±åƒèµ·ç‚¹é«˜åº¦ï¼Œb æ˜¯ä½ ä» y è½´å“ªä¸ªé«˜åº¦å¼€å§‹ç”»</p>
                        <p>â€¢ å¦‚æœçŸ¥é“ç›´çº¿ä¸Šä¸¤ä¸ªç‚¹ï¼Œå°±èƒ½æ±‚å‡º k å’Œ b</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>æ–¹æ³•1ï¼ˆä¸¤ç‚¹å¼ï¼‰ï¼š</strong>k = (yâ‚‚-yâ‚) / (xâ‚‚-xâ‚)<br>
                        <strong>æ–¹æ³•2ï¼ˆä»£å…¥æ³•ï¼‰ï¼š</strong>æŠŠä¸¤ä¸ªç‚¹ä»£å…¥ y=kx+bï¼Œè§£æ–¹ç¨‹ç»„<br><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"ä¸¤ç‚¹å®šä¸€ç›´çº¿ï¼Œå…ˆæ±‚kå†æ±‚b"
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ”„ ä¸¾ä¸€åä¸‰</h4>
                        <p>â€¢ å¦‚æœ k > 0ï¼Œç›´çº¿ä»å·¦ä¸‹åˆ°å³ä¸Šï¼ˆé€’å¢ï¼‰</p>
                        <p>â€¢ å¦‚æœ k < 0ï¼Œç›´çº¿ä»å·¦ä¸Šåˆ°å³ä¸‹ï¼ˆé€’å‡ï¼‰</p>
                        <p>â€¢ å¦‚æœ b = 0ï¼Œç›´çº¿è¿‡åŸç‚¹ï¼ˆæ­£æ¯”ä¾‹å‡½æ•°ï¼‰</p>
                    </div>
                `;
            } else {
                return `
                    <div class="feedback-title">ğŸ“š åæ¯”ä¾‹å‡½æ•°çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>åæ¯”ä¾‹å‡½æ•°è¡¨è¾¾å¼ï¼š</strong>y = k/x</p>
                        <p>â€¢ k å«åšæ¯”ä¾‹ç³»æ•°</p>
                        <p>â€¢ å›¾åƒæ˜¯åŒæ›²çº¿ï¼Œåˆ†å¸ƒåœ¨ä¸¤ä¸ªè±¡é™</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æƒ³è±¡ k æ˜¯"æ€»é¢ç§¯"ï¼š</p>
                        <p>â€¢ æ¨ªåæ ‡ x è¶Šå¤§ï¼Œçºµåæ ‡ y å°±è¶Šå°ï¼ˆåæ¯”å…³ç³»ï¼‰</p>
                        <p>â€¢ x Ã— y = kï¼ˆå°±åƒé•¿æ–¹å½¢é¢ç§¯ä¸å˜ï¼‰</p>
                        <p>â€¢ åŒæ›²çº¿æ°¸è¿œä¸ä¼šç¢°åˆ°åæ ‡è½´</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>å…³é”®å…¬å¼ï¼š</strong>k = x Ã— yï¼ˆæ¨ªåæ ‡ä¹˜çºµåæ ‡ï¼‰<br><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"ä¸€ç‚¹å®škå€¼ï¼Œkæ­£ä¸€ä¸‰è±¡é™ï¼Œkè´ŸäºŒå››è±¡é™"
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ”„ ä¸¾ä¸€åä¸‰</h4>
                        <p>â€¢ k > 0ï¼šå›¾åƒåœ¨ä¸€ã€ä¸‰è±¡é™</p>
                        <p>â€¢ k < 0ï¼šå›¾åƒåœ¨äºŒã€å››è±¡é™</p>
                        <p>â€¢ |k| è¶Šå¤§ï¼Œæ›²çº¿ç¦»åŸç‚¹è¶Šè¿œ</p>
                    </div>
                `;
            }
        }

        // åŠ¨ç‚¹é—®é¢˜çŸ¥è¯†ç‚¹è®²è§£
        function getMovingFeedback() {
            return `
                <div class="feedback-title">ğŸ“š åŠ¨ç‚¹ä¸é¢ç§¯çŸ¥è¯†ç‚¹è®²è§£</div>
                
                <div class="knowledge-section">
                    <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                    <p><strong>åŠ¨ç‚¹é—®é¢˜ä¸‰è¦ç´ ï¼š</strong></p>
                    <p>1. å˜é‡ tï¼ˆæ—¶é—´ï¼‰</p>
                    <p>2. å‡ ä½•é‡ï¼ˆè¾¹é•¿ã€é¢ç§¯ç­‰ï¼‰</p>
                    <p>3. å‡½æ•°å…³ç³»å¼ S = f(t)</p>
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                    <p>æƒ³è±¡ä¸€ä¸ªç‚¹åœ¨ç§»åŠ¨ï¼š</p>
                    <p>â€¢ éšç€æ—¶é—´ t å˜åŒ–ï¼Œç‚¹çš„ä½ç½®åœ¨å˜</p>
                    <p>â€¢ ç‚¹çš„ä½ç½®å˜äº†ï¼Œå½¢æˆçš„ä¸‰è§’å½¢é¢ç§¯ä¹Ÿåœ¨å˜</p>
                    <p>â€¢ æˆ‘ä»¬è¦æ‰¾å‡ºé¢ç§¯ S å’Œæ—¶é—´ t çš„å…³ç³»</p>
                </div>
                
                <div class="tip-box">
                    <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                    <strong>è§£é¢˜å››æ­¥æ³•ï¼š</strong><br>
                    1. æ‰¾åº•ï¼šå“ªä¸ªè¾¹æ˜¯ä¸å˜çš„ï¼ˆå¦‚ ABï¼‰<br>
                    2. æ‰¾é«˜ï¼šå“ªä¸ªè¾¹éšæ—¶é—´å˜åŒ–ï¼ˆå¦‚ BQï¼‰<br>
                    3. åˆ—å¼ï¼šS = Â½ Ã— åº• Ã— é«˜<br>
                    4. å®šä¹‰åŸŸï¼šç¡®å®š t çš„å–å€¼èŒƒå›´<br><br>
                    <strong>è®°å¿†å£è¯€ï¼š</strong>"åº•ä¸å˜ï¼Œé«˜éštï¼Œé¢ç§¯å…¬å¼ä»£è¿›å»"
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ”„ ä¸¾ä¸€åä¸‰</h4>
                    <p>â€¢ çŸ©å½¢åŠ¨ç‚¹ï¼šS = Â½ Ã— å®½ Ã— é€Ÿåº¦t</p>
                    <p>â€¢ ä¸‰è§’å½¢åŠ¨ç‚¹ï¼šç”¨åº•Ã—é«˜Ã·2</p>
                    <p>â€¢ æ³¨æ„ï¼šåŠ¨ç‚¹èµ°åˆ°é¡¶æ—¶ t æœ‰æœ€å¤§å€¼</p>
                </div>
            `;
        }

        // åæ ‡å˜æ¢çŸ¥è¯†ç‚¹è®²è§£
        function getTransformFeedback() {
            if (currentTransformQuestion.type === 'rotate') {
                return `
                    <div class="feedback-title">ğŸ“š åæ ‡æ—‹è½¬çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>ç»•åŸç‚¹æ—‹è½¬ 90Â° çš„åæ ‡å˜åŒ–ï¼š</strong></p>
                        <p>â€¢ é€†æ—¶é’ˆ 90Â°ï¼š(x, y) â†’ (-y, x)</p>
                        <p>â€¢ é¡ºæ—¶é’ˆ 90Â°ï¼š(x, y) â†’ (y, -x)</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æƒ³è±¡ä½ ç«™åœ¨åŸç‚¹ï¼š</p>
                        <p>â€¢ é€†æ—¶é’ˆè½¬ 90Â°ï¼ŒåŸæ¥çš„ x æ–¹å‘å˜æˆ y æ–¹å‘</p>
                        <p>â€¢ åŸæ¥çš„ y æ–¹å‘å˜æˆè´Ÿ x æ–¹å‘</p>
                        <p>â€¢ å°±åƒå‘å·¦è½¬ï¼Œå‰åå˜æˆå·¦å³</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"é€†æ—¶é’ˆï¼Œxå˜yçš„è´Ÿï¼Œyå˜x"<br><br>
                        <strong>å›¾ç¤ºè®°å¿†ï¼š</strong><br>
                        &nbsp;&nbsp;yâ†‘<br>
                        &nbsp;&nbsp;|<br>
                        &nbsp;&nbsp;|&nbsp;&nbsp;(x,y) â†’ (-y,x)<br>
                        â€”â€”â€”â€”â†’x<br><br>
                        <strong>æ¨å¹¿ï¼š</strong><br>
                        â€¢ æ—‹è½¬ 180Â°ï¼š(x, y) â†’ (-x, -y)<br>
                        â€¢ æ—‹è½¬ 270Â°ï¼š(x, y) â†’ (y, -x)
                    </div>
                `;
            } else {
                return `
                    <div class="feedback-title">ğŸ“š åæ ‡å¹³ç§»çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>å¹³ç§»è§„å¾‹ï¼š</strong></p>
                        <p>â€¢ å‘å³å¹³ç§» aï¼š(x, y) â†’ (x+a, y)</p>
                        <p>â€¢ å‘å·¦å¹³ç§» aï¼š(x, y) â†’ (x-a, y)</p>
                        <p>â€¢ å‘ä¸Šå¹³ç§» bï¼š(x, y) â†’ (x, y+b)</p>
                        <p>â€¢ å‘ä¸‹å¹³ç§» bï¼š(x, y) â†’ (x, y-b)</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æƒ³è±¡ä½ åœ¨ç§»åŠ¨ä¸€ä¸ªç‚¹ï¼š</p>
                        <p>â€¢ å‘å³/å·¦ç§»åŠ¨ï¼Œåªæ”¹å˜ x åæ ‡</p>
                        <p>â€¢ å‘ä¸Š/ä¸‹ç§»åŠ¨ï¼Œåªæ”¹å˜ y åæ ‡</p>
                        <p>â€¢ å°±åƒåœ¨æ–¹æ ¼çº¸ä¸Šç§»åŠ¨æ£‹å­</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"å·¦å‡å³åŠ ï¼Œä¸ŠåŠ ä¸‹å‡"<br><br>
                        <strong>ç†è§£ï¼š</strong><br>
                        â€¢ å‘å³èµ° â†’ x å¢å¤§ â†’ åŠ <br>
                        â€¢ å‘å·¦èµ° â†’ x å‡å° â†’ å‡<br>
                        â€¢ å‘ä¸Šèµ° â†’ y å¢å¤§ â†’ åŠ <br>
                        â€¢ å‘ä¸‹èµ° â†’ y å‡å° â†’ å‡
                    </div>
                `;
            }
        }

        // äºŒæ¬¡å‡½æ•°çŸ¥è¯†ç‚¹è®²è§£
        function getQuadraticFeedback() {
            return `
                <div class="feedback-title">ğŸ“š äºŒæ¬¡å‡½æ•°æ€§è´¨çŸ¥è¯†ç‚¹è®²è§£</div>
                
                <div class="knowledge-section">
                    <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                    <p><strong>äºŒæ¬¡å‡½æ•°ï¼š</strong>y = axÂ² + bx + c</p>
                    <p>â€¢ a å†³å®šå¼€å£æ–¹å‘ï¼ša>0 å‘ä¸Šï¼Œa<0 å‘ä¸‹</p>
                    <p>â€¢ å¯¹ç§°è½´ï¼šx = -b/(2a)</p>
                    <p>â€¢ é¡¶ç‚¹åæ ‡ï¼š(-b/(2a), (4ac-bÂ²)/(4a))</p>
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                    <p>æƒ³è±¡ä¸€ä¸ªæŠ›ç‰©çº¿ï¼š</p>
                    <p>â€¢ a åƒç¢—çš„å½¢çŠ¶ï¼ša>0 ç¢—å£å‘ä¸Šï¼Œa<0 ç¢—å£å‘ä¸‹</p>
                    <p>â€¢ å¯¹ç§°è½´åƒä¸­è½´çº¿ï¼Œä¸¤è¾¹å¯¹ç§°</p>
                    <p>â€¢ c æ˜¯æŠ›ç‰©çº¿ä¸ y è½´çš„äº¤ç‚¹é«˜åº¦</p>
                </div>
                
                <div class="tip-box">
                    <strong>âš¡ å¿«é€Ÿåˆ¤æ–­æŠ€å·§ï¼š</strong><br>
                    <strong>çœ‹å›¾åˆ¤æ–­ï¼š</strong><br>
                    1. å¼€å£æ–¹å‘ â†’ çœ‹ aï¼ˆå‘ä¸Šä¸ºæ­£ï¼‰<br>
                    2. y æˆªè· â†’ çœ‹ cï¼ˆä¸ y è½´äº¤ç‚¹ï¼‰<br>
                    3. å¯¹ç§°è½´ â†’ çœ‹ b å’Œ a çš„å…³ç³»<br>
                    4. ä¸ x è½´äº¤ç‚¹ â†’ çœ‹åˆ¤åˆ«å¼ Î”=bÂ²-4ac<br><br>
                    <strong>è®°å¿†ï¼š</strong>"açœ‹å¼€å£ï¼Œcçœ‹æˆªè·ï¼Œbçœ‹å¯¹ç§°è½´ä½ç½®"
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ”„ å¸¸è€ƒç»“è®º</h4>
                    <p>â€¢ abc > 0ï¼šaã€bã€c åŒå·</p>
                    <p>â€¢ b = 2aï¼šå¯¹ç§°è½´ x = -1</p>
                    <p>â€¢ 4a + 2b + cï¼šx=2 æ—¶çš„å‡½æ•°å€¼</p>
                </div>
            `;
        }

        // æ–¹ç¨‹æ ¹çŸ¥è¯†ç‚¹è®²è§£
        function getEquationFeedback() {
            return `
                <div class="feedback-title">ğŸ“š éŸ¦è¾¾å®šç†çŸ¥è¯†ç‚¹è®²è§£</div>
                
                <div class="knowledge-section">
                    <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                    <p><strong>éŸ¦è¾¾å®šç†ï¼š</strong>å¯¹äºæ–¹ç¨‹ axÂ² + bx + c = 0</p>
                    <p>â€¢ xâ‚ + xâ‚‚ = -b/aï¼ˆä¸¤æ ¹ä¹‹å’Œï¼‰</p>
                    <p>â€¢ xâ‚ Ã— xâ‚‚ = c/aï¼ˆä¸¤æ ¹ä¹‹ç§¯ï¼‰</p>
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                    <p>éŸ¦è¾¾å®šç†å‘Šè¯‰ä½ ï¼š</p>
                    <p>â€¢ ä¸ç”¨è§£æ–¹ç¨‹ï¼Œå°±èƒ½çŸ¥é“ä¸¤æ ¹çš„å’Œä¸ç§¯</p>
                    <p>â€¢ å’Œ = -ä¸€æ¬¡é¡¹ç³»æ•°/äºŒæ¬¡é¡¹ç³»æ•°</p>
                    <p>â€¢ ç§¯ = å¸¸æ•°é¡¹/äºŒæ¬¡é¡¹ç³»æ•°</p>
                </div>
                
                <div class="tip-box">
                    <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                    <strong>è®°å¿†å£è¯€ï¼š</strong>"å’Œè´Ÿbï¼Œç§¯cï¼Œåˆ†æ¯éƒ½æ˜¯a"<br><br>
                    <strong>è¡¨è¾¾å¼æ±‚å€¼æŠ€å·§ï¼š</strong><br>
                    1. æŠŠè¡¨è¾¾å¼å±•å¼€æˆ xâ‚+xâ‚‚ å’Œ xâ‚Ã—xâ‚‚ çš„ç»„åˆ<br>
                    2. ä»£å…¥éŸ¦è¾¾å®šç†çš„å€¼<br>
                    3. è®¡ç®—ç»“æœ<br><br>
                    <strong>ä¾‹ï¼š</strong>(xâ‚-2)(xâ‚‚-2) = xâ‚xâ‚‚ - 2(xâ‚+xâ‚‚) + 4
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ”„ å¸¸è€ƒå˜å½¢</h4>
                    <p>â€¢ xâ‚Â² + xâ‚‚Â² = (xâ‚+xâ‚‚)Â² - 2xâ‚xâ‚‚</p>
                    <p>â€¢ 1/xâ‚ + 1/xâ‚‚ = (xâ‚+xâ‚‚)/(xâ‚xâ‚‚)</p>
                    <p>â€¢ |xâ‚ - xâ‚‚| = âˆš[(xâ‚+xâ‚‚)Â² - 4xâ‚xâ‚‚]</p>
                </div>
            `;
        }

        // ä¸ç­‰å¼çŸ¥è¯†ç‚¹è®²è§£
        function getInequalityFeedback() {
            return `
                <div class="feedback-title">ğŸ“š ä¸ç­‰å¼ç»„çŸ¥è¯†ç‚¹è®²è§£</div>
                
                <div class="knowledge-section">
                    <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                    <p><strong>ä¸ç­‰å¼ç»„æ±‚è§£ï¼š</strong></p>
                    <p>â€¢ åˆ†åˆ«è§£æ¯ä¸ªä¸ç­‰å¼</p>
                    <p>â€¢ æ‰¾å…¬å…±éƒ¨åˆ†ï¼ˆä¸¤ä¸ªè§£é›†éƒ½æ»¡è¶³çš„èŒƒå›´ï¼‰</p>
                </div>
                
                <div class="knowledge-section">
                    <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                    <p>æƒ³è±¡ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
                    <p>â€¢ x > 2 æ„æ€æ˜¯ x åœ¨ 2 çš„å³è¾¹</p>
                    <p>â€¢ x < 5 æ„æ€æ˜¯ x åœ¨ 5 çš„å·¦è¾¹</p>
                    <p>â€¢ ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œå°±æ˜¯ 2 å’Œ 5 ä¹‹é—´</p>
                </div>
                
                <div class="tip-box">
                    <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                    <strong>å£è¯€ï¼š</strong>"åŒå¤§å–å¤§ï¼ŒåŒå°å–å°ï¼Œå¤§å°å°å¤§ä¸­é—´æ‰¾ï¼Œå¤§å¤§å°å°æ‰¾ä¸åˆ°"<br><br>
                    <strong>å››ç§æƒ…å†µï¼š</strong><br>
                    â€¢ x > 2 ä¸” x > 5 â†’ x > 5ï¼ˆå–å¤§çš„ï¼‰<br>
                    â€¢ x < 2 ä¸” x < 5 â†’ x < 2ï¼ˆå–å°çš„ï¼‰<br>
                    â€¢ x > 2 ä¸” x < 5 â†’ 2 < x < 5ï¼ˆä¸­é—´ï¼‰<br>
                    â€¢ x < 2 ä¸” x > 5 â†’ æ— è§£ï¼ˆçŸ›ç›¾ï¼‰<br><br>
                    <strong>ç”»æ•°è½´æœ€ç›´è§‚ï¼</strong>
                </div>
            `;
        }

        // æ¦‚ç‡çŸ¥è¯†ç‚¹è®²è§£
        function getProbabilityFeedback() {
            if (currentProbabilityQuestion.type === 'tree') {
                return `
                    <div class="feedback-title">ğŸ“š æ ‘çŠ¶å›¾æ¦‚ç‡çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>ç­‰å¯èƒ½äº‹ä»¶æ¦‚ç‡ï¼š</strong></p>
                        <p>P(A) = æœ‰åˆ©ç»“æœæ•° / æ‰€æœ‰å¯èƒ½ç»“æœæ•°</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æ ‘çŠ¶å›¾å°±åƒå®¶è°±ï¼š</p>
                        <p>â€¢ ç¬¬ä¸€å±‚ï¼šç”²çš„é€‰æ‹©ï¼ˆ3ä¸ªåˆ†æ”¯ï¼‰</p>
                        <p>â€¢ ç¬¬äºŒå±‚ï¼šä¹™çš„é€‰æ‹©ï¼ˆæ¯ä¸ªåˆ†æ”¯ä¸‹3ä¸ªï¼‰</p>
                        <p>â€¢ æ€»å…± 3Ã—3 = 9 ç§å¯èƒ½</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>è§£é¢˜æ­¥éª¤ï¼š</strong><br>
                        1. ç”»æ ‘çŠ¶å›¾ï¼ˆæˆ–åˆ—è¡¨ï¼‰<br>
                        2. æ•°æ€»æ•°ï¼ˆæ‰€æœ‰å¯èƒ½ç»“æœï¼‰<br>
                        3. æ•°æœ‰åˆ©ï¼ˆæ»¡è¶³æ¡ä»¶çš„ç»“æœï¼‰<br>
                        4. ç®—æ¦‚ç‡ï¼ˆæœ‰åˆ©/æ€»æ•°ï¼‰<br><br>
                        <strong>æŠ€å·§ï¼š</strong>åˆ—è¡¨æ³•æ¯”æ ‘çŠ¶å›¾æ›´å¿«ï¼
                    </div>
                `;
            } else if (currentProbabilityQuestion.type === 'spinner') {
                return `
                    <div class="feedback-title">ğŸ“š æœŸæœ›å€¼çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>æœŸæœ›å€¼å…¬å¼ï¼š</strong></p>
                        <p>E = Î£(å€¼ Ã— æ¦‚ç‡)</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>æœŸæœ›å€¼å°±æ˜¯"å¹³å‡å€¼"ï¼š</p>
                        <p>â€¢ å¦‚æœè½¬å¾ˆå¤šæ¬¡ï¼Œå¹³å‡æ¯æ¬¡èƒ½å¾—å¤šå°‘</p>
                        <p>â€¢ æŠŠæ¯ç§æƒ…å†µçš„"å€¼Ã—æ¦‚ç‡"åŠ èµ·æ¥</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>è®¡ç®—æ–¹æ³•ï¼š</strong><br>
                        E = 45Ã—(çº¢è‰²ä¸ªæ•°/12) + 30Ã—(é»„è‰²ä¸ªæ•°/12) + 15Ã—(ç»¿è‰²ä¸ªæ•°/12)<br><br>
                        <strong>ç†è§£ï¼š</strong>æœŸæœ›å€¼ = åŠ æƒå¹³å‡
                    </div>
                `;
            } else {
                return `
                    <div class="feedback-title">ğŸ“š åŸºç¡€æ¦‚ç‡çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>ç­‰å¯èƒ½äº‹ä»¶ï¼š</strong>æ¯ä¸ªç»“æœå‡ºç°çš„å¯èƒ½æ€§ç›¸åŒ</p>
                        <p>P = 1/nï¼ˆn æ˜¯æ€»æ•°ï¼‰</p>
                    </div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ’¡ é€šä¿—ç†è§£</h4>
                        <p>éª°å­æœ‰6ä¸ªé¢ï¼š</p>
                        <p>â€¢ æ¯ä¸ªé¢æœä¸Šçš„æœºä¼šç›¸ç­‰</p>
                        <p>â€¢ æ·å‡ºæŸä¸ªç‚¹çš„æ¦‚ç‡ = 1/6</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å…³é”®ï¼š</strong>"ç­‰å¯èƒ½"æ„å‘³ç€æ¯ä¸ªç»“æœæ¦‚ç‡ç›¸åŒ
                    </div>
                `;
            }
        }

        // å‡ ä½•è¯æ˜çŸ¥è¯†ç‚¹è®²è§£
        function getGeometryFeedback() {
            if (currentGeometryQuestion.type === 'circle') {
                return `
                    <div class="feedback-title">ğŸ“š åœ†çš„æ€§è´¨çŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>åœ†çš„å››å¤§å®šç†ï¼š</strong></p>
                        <p>1. åœ†å‘¨è§’å®šç†ï¼šåŒå¼§æ‰€å¯¹åœ†å‘¨è§’ç›¸ç­‰</p>
                        <p>2. å‚å¾„å®šç†ï¼šå‚ç›´äºå¼¦çš„ç›´å¾„å¹³åˆ†å¼¦</p>
                        <p>3. åˆ‡çº¿æ€§è´¨ï¼šåˆ‡çº¿å‚ç›´äºè¿‡åˆ‡ç‚¹çš„åŠå¾„</p>
                        <p>4. ç›´å¾„æ‰€å¯¹åœ†å‘¨è§’ä¸º90Â°</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>çœ‹åˆ°åˆ‡çº¿æƒ³åˆ°ï¼š</strong>å‚ç›´äºåŠå¾„<br>
                        <strong>çœ‹åˆ°ç›´å¾„æƒ³åˆ°ï¼š</strong>åœ†å‘¨è§’=90Â°<br>
                        <strong>çœ‹åˆ°å¼¦å’Œå¼¦å¿ƒè·æƒ³åˆ°ï¼š</strong>å‚å¾„å®šç†<br><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"åˆ‡çº¿âŠ¥åŠå¾„ï¼Œç›´å¾„å¯¹ç›´è§’ï¼Œå‚å¾„å¹³åˆ†å¼¦"
                    </div>
                `;
            } else if (currentGeometryQuestion.type === 'parallelogram') {
                return `
                    <div class="feedback-title">ğŸ“š å¹³è¡Œå››è¾¹å½¢åˆ¤å®šçŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>äº”ç§åˆ¤å®šæ–¹æ³•ï¼š</strong></p>
                        <p>1. ä¸¤ç»„å¯¹è¾¹åˆ†åˆ«å¹³è¡Œ</p>
                        <p>2. ä¸¤ç»„å¯¹è¾¹åˆ†åˆ«ç›¸ç­‰</p>
                        <p>3. ä¸€ç»„å¯¹è¾¹å¹³è¡Œä¸”ç›¸ç­‰</p>
                        <p>4. å¯¹è§’çº¿äº’ç›¸å¹³åˆ†</p>
                        <p>5. ä¸¤ç»„å¯¹è§’åˆ†åˆ«ç›¸ç­‰</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å¿«é€ŸæŒæ¡æŠ€å·§ï¼š</strong><br>
                        <strong>æœ€å¸¸ç”¨ï¼š</strong>ä¸€ç»„å¯¹è¾¹å¹³è¡Œä¸”ç›¸ç­‰<br>
                        <strong>æ³¨æ„ï¼š</strong>AC=BD ä¸èƒ½åˆ¤å®šå¹³è¡Œå››è¾¹å½¢<br><br>
                        <strong>è®°å¿†å£è¯€ï¼š</strong>"è¾¹å¹³è¡Œã€è¾¹ç›¸ç­‰ã€å¯¹è§’å¹³åˆ†"
                    </div>
                `;
            } else {
                return `
                    <div class="feedback-title">ğŸ“š çŸ©å½¢åˆ¤å®šçŸ¥è¯†ç‚¹è®²è§£</div>
                    
                    <div class="knowledge-section">
                        <h4>ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹</h4>
                        <p><strong>ä¸‰ç§åˆ¤å®šæ–¹æ³•ï¼š</strong></p>
                        <p>1. æœ‰ä¸€ä¸ªè§’æ˜¯ç›´è§’çš„å¹³è¡Œå››è¾¹å½¢</p>
                        <p>2. å¯¹è§’çº¿ç›¸ç­‰çš„å¹³è¡Œå››è¾¹å½¢</p>
                        <p>3. å››ä¸ªè§’éƒ½æ˜¯ç›´è§’çš„å››è¾¹å½¢</p>
                    </div>
                    
                    <div class="tip-box">
                        <strong>âš¡ å…³é”®åŒºåˆ«ï¼š</strong><br>
                        â€¢ çŸ©å½¢ï¼šå¯¹è§’çº¿ç›¸ç­‰<br>
                        â€¢ è±å½¢ï¼šå¯¹è§’çº¿å‚ç›´<br>
                        â€¢ æ­£æ–¹å½¢ï¼šæ—¢ç›¸ç­‰åˆå‚ç›´<br><br>
                        <strong>è®°å¿†ï¼š</strong>"çŸ©å½¢ç­‰ï¼Œè±å½¢å‚ï¼Œæ­£æ–¹å½¢éƒ½å…·å¤‡"
                    </div>
                `;
            }
        }

        function resetResult(type) {
            const answerInput = document.getElementById(`${type}-answer`);
            if (answerInput) answerInput.value = '';
            
            const resultDiv = document.getElementById(`${type}-result`);
            if (resultDiv) {
                resultDiv.className = 'result';
                resultDiv.textContent = '';
            }
            
            const hintDiv = document.getElementById(`${type}-hint`);
            if (hintDiv) hintDiv.style.display = 'none';
            
            const feedbackDiv = document.getElementById(`${type}-feedback`);
            if (feedbackDiv) feedbackDiv.classList.remove('show');
        }

        function updateStats(isCorrect) {
            if (isCorrect) correctCount++;
            else wrongCount++;
            
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('wrong-count').textContent = wrongCount;
            
            const total = correctCount + wrongCount;
            document.getElementById('accuracy').textContent = (total > 0 ? Math.round(correctCount / total * 100) : 0) + '%';
        }

        function simplifyAnswer(answer) {
            return answer.replace(/y=/g, '').replace(/\s/g, '').replace(/\+\-/g, '-');
        }

        // ==================== æ¦‚ç‡æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        let currentProbabilityQuestion = null;

        function generateProbabilityQuestion() {
            const types = ['tree', 'spinner', 'dice'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'tree') {
                // æ ‘çŠ¶å›¾æ¦‚ç‡ï¼ˆå¯¹åº”è¯•å·17é¢˜ï¼‰
                const aChoices = ['A', 'B', 'C'];
                const bChoices = ['B', 'C', 'D'];
                const commonChoices = aChoices.filter(c => bChoices.includes(c)); // B, C
                
                currentProbabilityQuestion = {
                    type: 'tree',
                    aChoices: aChoices,
                    bChoices: bChoices,
                    total: 9,
                    favorable: commonChoices.length,
                    answer: `${commonChoices.length}/9`,
                    commonChoices: commonChoices
                };
                
                document.getElementById('probability-question').innerHTML = `
                    ã€æ ‘çŠ¶å›¾æ¦‚ç‡ã€‘ç”²åŒå­¦ä» Aã€Bã€C ä¸‰ç±»ä¹¦ç±ä¸­éšæœºé€‰æ‹©ä¸€ç§ï¼Œä¹™åŒå­¦ä» Bã€Cã€D ä¸‰ç±»ä¹¦ç±ä¸­éšæœºé€‰æ‹©ä¸€ç§ã€‚<br>
                    ç”¨æ ‘çŠ¶å›¾æˆ–åˆ—è¡¨æ³•ï¼Œæ±‚ç”²ä¹™ä¸¤ä½åŒå­¦é€‰æ‹©ç›¸åŒç±»åˆ«ä¹¦ç±çš„æ¦‚ç‡ã€‚`;
                
                drawTreeDiagram();
            } else if (type === 'spinner') {
                // è½¬ç›˜æ¦‚ç‡ï¼ˆå¯¹åº”è¯•å·7é¢˜ï¼‰
                const red = Math.floor(Math.random() * 3) + 1;
                const yellow = Math.floor(Math.random() * 3) + 1;
                const green = Math.floor(Math.random() * 3) + 1;
                const total = 12;
                
                const expectedValue = (red * 45 + yellow * 30 + green * 15) / total;
                
                currentProbabilityQuestion = {
                    type: 'spinner',
                    red, yellow, green, total,
                    answer: expectedValue.toFixed(2),
                    expectedValue
                };
                
                document.getElementById('probability-question').innerHTML = `
                    ã€è½¬ç›˜æœŸæœ›ã€‘è½¬ç›˜ç­‰åˆ†æˆ12ä¸ªæ‰‡å½¢ï¼Œå…¶ä¸­çº¢è‰²${red}ä¸ªã€é»„è‰²${yellow}ä¸ªã€ç»¿è‰²${green}ä¸ªã€‚<br>
                    è½¬åŠ¨ä¸€æ¬¡ï¼ŒæŒ‡é’ˆæŒ‡å‘çº¢è‰²å¾—45å…ƒã€é»„è‰²å¾—30å…ƒã€ç»¿è‰²å¾—15å…ƒã€‚<br>
                    æ±‚è·å¾—è´­ç‰©åˆ¸é‡‘é¢çš„æœŸæœ›å€¼ï¼ˆå¹³å‡æ•°ï¼‰ã€‚`;
                
                drawSpinner();
            } else {
                // éª°å­æ¦‚ç‡
                const target = Math.floor(Math.random() * 6) + 1;
                const favorable = 1;
                const total = 6;
                
                currentProbabilityQuestion = {
                    type: 'dice',
                    target,
                    answer: '1/6',
                    favorable,
                    total
                };
                
                document.getElementById('probability-question').innerHTML = `
                    ã€éª°å­æ¦‚ç‡ã€‘æ·ä¸€æšè´¨åœ°å‡åŒ€çš„éª°å­ä¸€æ¬¡ï¼Œæ±‚ç‚¹æ•°ä¸º ${target} çš„æ¦‚ç‡ã€‚`;
                
                drawDice(target);
            }
            
            resetResult('probability');
        }

        function drawTreeDiagram() {
            const canvas = document.getElementById('probability-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            
            // èµ·ç‚¹
            ctx.beginPath();
            ctx.arc(40, h/2, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ç”²çš„åˆ†æ”¯
            const aChoices = ['A', 'B', 'C'];
            aChoices.forEach((choice, i) => {
                const x1 = 100, y1 = 40 + i * 50;
                
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(48, h/2);
                ctx.lineTo(x1 - 20, y1);
                ctx.stroke();
                
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x1, y1, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#333';
                ctx.fillText(choice, x1 + 15, y1 + 5);
                
                // ä¹™çš„åˆ†æ”¯
                const bChoices = ['B', 'C', 'D'];
                bChoices.forEach((bChoice, j) => {
                    const x2 = 200, y2 = y1 - 25 + j * 25;
                    
                    ctx.strokeStyle = '#764ba2';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x1 + 6, y1);
                    ctx.lineTo(x2 - 20, y2);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#764ba2';
                    ctx.beginPath();
                    ctx.arc(x2, y2, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Noto Sans SC';
                    ctx.fillText(bChoice, x2 + 10, y2 + 4);
                });
            });
            
            // æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('ç”²', 60, h/2 - 15);
            ctx.fillText('ä¹™', 160, 20);
        }

        function drawSpinner() {
            const canvas = document.getElementById('probability-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const {red, yellow, green} = currentProbabilityQuestion;
            const centerX = w / 2, centerY = h / 2;
            const radius = 70;
            
            const colors = ['#e74c3c', '#f39c12', '#27ae60'];
            const counts = [red, yellow, green];
            const labels = ['çº¢', 'é»„', 'ç»¿'];
            
            let startAngle = -Math.PI / 2;
            
            counts.forEach((count, i) => {
                const sliceAngle = (count / 12) * Math.PI * 2;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[i];
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // æ ‡ç­¾
                const midAngle = startAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(midAngle) * (radius * 0.6);
                const labelY = centerY + Math.sin(midAngle) * (radius * 0.6);
                
                ctx.fillStyle = '#fff';
                ctx.font = '14px Noto Sans SC';
                ctx.textAlign = 'center';
                ctx.fillText(labels[i], labelX, labelY + 5);
                
                startAngle += sliceAngle;
            });
            
            // æŒ‡é’ˆ
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - radius - 15);
            ctx.lineTo(centerX - 8, centerY - radius + 5);
            ctx.lineTo(centerX + 8, centerY - radius + 5);
            ctx.closePath();
            ctx.fillStyle = '#333';
            ctx.fill();
        }

        function drawDice(target) {
            const canvas = document.getElementById('probability-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const size = 80;
            const x = w/2 - size/2, y = h/2 - size/2;
            
            // éª°å­å¤–æ¡†
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y, size, size);
            
            // ç‚¹ä½
            const dotPositions = {
                1: [[0.5, 0.5]],
                2: [[0.25, 0.25], [0.75, 0.75]],
                3: [[0.25, 0.25], [0.5, 0.5], [0.75, 0.75]],
                4: [[0.25, 0.25], [0.75, 0.25], [0.25, 0.75], [0.75, 0.75]],
                5: [[0.25, 0.25], [0.75, 0.25], [0.5, 0.5], [0.25, 0.75], [0.75, 0.75]],
                6: [[0.25, 0.25], [0.75, 0.25], [0.25, 0.5], [0.75, 0.5], [0.25, 0.75], [0.75, 0.75]]
            };
            
            ctx.fillStyle = '#333';
            dotPositions[target].forEach(pos => {
                ctx.beginPath();
                ctx.arc(x + pos[0] * size, y + pos[1] * size, 6, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function checkProbabilityAnswer() {
            const userAnswer = document.getElementById('probability-answer').value.replace(/\s/g, '');
            const correctAnswer = currentProbabilityQuestion.answer;
            
            // å¤šç§æ ¼å¼åˆ¤æ–­
            let isCorrect = userAnswer === correctAnswer;
            
            if (currentProbabilityQuestion.type === 'tree') {
                isCorrect = isCorrect || userAnswer === `${currentProbabilityQuestion.favorable}/9`;
            } else if (currentProbabilityQuestion.type === 'spinner') {
                isCorrect = isCorrect || Math.abs(parseFloat(userAnswer) - currentProbabilityQuestion.expectedValue) < 0.01;
            }
            
            showResult('probability', isCorrect, currentProbabilityQuestion.answer);
            updateStats(isCorrect);
        }

        function showProbabilityHint() {
            const hintDiv = document.getElementById('probability-hint');
            
            if (currentProbabilityQuestion.type === 'tree') {
                hintDiv.innerHTML = `
                    <strong>è§£é¢˜æ­¥éª¤ï¼š</strong><br>
                    1. ç”»æ ‘çŠ¶å›¾ï¼šç”²æœ‰3ä¸ªåˆ†æ”¯(A,B,C)ï¼Œæ¯ä¸ªåˆ†æ”¯ä¸‹ä¹™æœ‰3ä¸ªåˆ†æ”¯(B,C,D)<br>
                    2. å…±æœ‰ 3Ã—3 = 9 ç§ç­‰å¯èƒ½ç»“æœ<br>
                    3. æ‰¾å‡ºç›¸åŒç±»åˆ«ï¼š(A,B), (A,C), (A,D)<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                       (B,B), (B,C), (B,D)<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                       (C,B), (C,C), (C,D)<br>
                    4. ç›¸åŒç±»åˆ«ï¼š(B,B), (C,C) å…±2ç§<br>
                    5. æ¦‚ç‡ = 2/9<br><br>
                    <strong>æŠ€å·§ï¼š</strong>åˆ—è¡¨æ³•æ›´ç›´è§‚`;
            } else if (currentProbabilityQuestion.type === 'spinner') {
                const {red, yellow, green} = currentProbabilityQuestion;
                hintDiv.innerHTML = `
                    <strong>æœŸæœ›å€¼å…¬å¼ï¼š</strong><br>
                    E = Î£(å€¼ Ã— æ¦‚ç‡)<br><br>
                    <strong>è®¡ç®—ï¼š</strong><br>
                    E = 45 Ã— ${red}/12 + 30 Ã— ${yellow}/12 + 15 Ã— ${green}/12<br>
                    &nbsp;&nbsp;&nbsp;= ${45*red + 30*yellow + 15*green}/12<br>
                    &nbsp;&nbsp;&nbsp;= ${currentProbabilityQuestion.expectedValue.toFixed(2)} å…ƒ`;
            } else {
                hintDiv.innerHTML = `
                    <strong>ç­‰å¯èƒ½äº‹ä»¶æ¦‚ç‡ï¼š</strong><br>
                    P(A) = æœ‰åˆ©ç»“æœæ•° / æ‰€æœ‰å¯èƒ½ç»“æœæ•°<br><br>
                    <strong>éª°å­ï¼š</strong><br>
                    â€¢ å…±6ä¸ªé¢ï¼Œæ¯ä¸ªé¢æœä¸Šæ¦‚ç‡ç›¸ç­‰<br>
                    â€¢ ç‚¹æ•°ä¸º${currentProbabilityQuestion.target}åªæœ‰1ä¸ªé¢<br>
                    â€¢ P = 1/6`;
            }
            hintDiv.style.display = 'block';
        }

        // ==================== å‡ ä½•è¯æ˜æ¨¡å—ï¼ˆæ–°å¢ï¼‰====================
        let currentGeometryQuestion = null;
        let selectedGeometryOption = -1;

        function generateGeometryQuestion() {
            const types = ['circle', 'parallelogram', 'rectangle'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'circle') {
                // åœ†çš„æ€§è´¨ï¼ˆå¯¹åº”è¯•å·18é¢˜ï¼‰
                currentGeometryQuestion = {
                    type: 'circle',
                    question: `ã€åœ†çš„æ€§è´¨ã€‘å¦‚å›¾ï¼ŒAB æ˜¯ âŠ™O çš„ç›´å¾„ï¼Œå¼¦ CD âŠ¥ AB äºç‚¹ Eï¼Œè¿‡ B ä½œ âŠ™O çš„åˆ‡çº¿ï¼Œäº¤ AC çš„å»¶é•¿çº¿äº Fï¼Œè¿æ¥ BDã€‚<br><br>
                        ä¸‹åˆ—ç»“è®ºä¸­ï¼Œæ­£ç¡®çš„ä¸ªæ•°æ˜¯ï¼š<br>
                        â‘  âˆ ABD = âˆ ACD  â‘¡ BF // CD  â‘¢ è‹¥ AC=8, BD=6ï¼Œåˆ™ CD=9.6`,
                    options: ['0ä¸ª', '1ä¸ª', '2ä¸ª', '3ä¸ª'],
                    correct: 3,
                    explanation: 'â‘ åŒå¼§æ‰€å¯¹åœ†å‘¨è§’ç›¸ç­‰ âœ“ â‘¡åˆ‡çº¿âŠ¥åŠå¾„ï¼ŒCDâŠ¥ABï¼Œâˆ´CD//BF âœ“ â‘¢ç”¨å‚å¾„å®šç†å’Œå‹¾è‚¡å®šç† âœ“'
                };
            } else if (type === 'parallelogram') {
                // å¹³è¡Œå››è¾¹å½¢ï¼ˆå¯¹åº”è¯•å·23é¢˜ï¼‰
                currentGeometryQuestion = {
                    type: 'parallelogram',
                    question: `ã€å¹³è¡Œå››è¾¹å½¢åˆ¤å®šã€‘å¦‚å›¾ï¼Œå››è¾¹å½¢ ABCD ä¸­ï¼ŒAD=BCï¼ŒAD//BCã€‚<br><br>
                        ä¸‹åˆ—æ¡ä»¶ä¸­ï¼Œèƒ½åˆ¤å®šå››è¾¹å½¢ ABCD æ˜¯å¹³è¡Œå››è¾¹å½¢çš„æœ‰ï¼š<br>
                        â‘  AB=CD  â‘¡ âˆ A+âˆ B=180Â°  â‘¢ AC=BD  â‘£ å¯¹è§’çº¿äº’ç›¸å¹³åˆ†`,
                    options: ['â‘ â‘¡', 'â‘¡â‘¢', 'â‘ â‘¡â‘£', 'â‘ â‘¡â‘¢â‘£'],
                    correct: 2,
                    explanation: 'â‘ ä¸€ç»„å¯¹è¾¹å¹³è¡Œä¸”ç›¸ç­‰ âœ“ â‘¡åŒæ—å†…è§’äº’è¡¥ï¼ŒAB//CD âœ“ â‘£å¯¹è§’çº¿äº’ç›¸å¹³åˆ† âœ“ â‘¢æ¡ä»¶ä¸è¶³'
                };
            } else {
                // çŸ©å½¢åˆ¤å®š
                currentGeometryQuestion = {
                    type: 'rectangle',
                    question: `ã€çŸ©å½¢åˆ¤å®šã€‘å¦‚å›¾ï¼Œå¹³è¡Œå››è¾¹å½¢ ABCD ä¸­ï¼Œå¯¹è§’çº¿ ACã€BD äº¤äºç‚¹ Oã€‚<br><br>
                        ä¸‹åˆ—æ¡ä»¶ä¸­ï¼Œèƒ½åˆ¤å®š ABCD æ˜¯çŸ©å½¢çš„æœ‰ï¼š<br>
                        â‘  AC=BD  â‘¡ âˆ ABC=90Â°  â‘¢ OA=OB=OC=OD  â‘£ ACâŠ¥BD`,
                    options: ['â‘ â‘¡', 'â‘ â‘¡â‘¢', 'â‘ â‘¡â‘£', 'â‘ â‘¡â‘¢â‘£'],
                    correct: 1,
                    explanation: 'â‘ å¯¹è§’çº¿ç›¸ç­‰çš„å¹³è¡Œå››è¾¹å½¢æ˜¯çŸ©å½¢ âœ“ â‘¡æœ‰ä¸€ä¸ªè§’æ˜¯ç›´è§’çš„å¹³è¡Œå››è¾¹å½¢æ˜¯çŸ©å½¢ âœ“ â‘¢ç­‰ä»·äºAC=BD âœ“ â‘£å¯¹è§’çº¿å‚ç›´æ˜¯è±å½¢'
                };
            }
            
            document.getElementById('geometry-question').innerHTML = currentGeometryQuestion.question;
            
            // ç”Ÿæˆé€‰é¡¹
            const optionsDiv = document.getElementById('geometry-options');
            optionsDiv.innerHTML = currentGeometryQuestion.options.map((opt, i) => 
                `<div class="option" onclick="selectGeometryOption(${i})" id="g-opt-${i}">${String.fromCharCode(65 + i)}. ${opt}</div>`
            ).join('');
            
            drawGeometryFigure(type);
            resetResult('geometry');
            selectedGeometryOption = -1;
            
            // é‡ç½®é€‰é¡¹æ ·å¼
            document.querySelectorAll('#geometry-options .option').forEach(opt => {
                opt.classList.remove('selected', 'correct-answer', 'wrong-answer');
            });
        }

        function drawGeometryFigure(type) {
            const canvas = document.getElementById('geometry-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            if (type === 'circle') {
                // ç”»åœ†
                const centerX = w/2, centerY = h/2, radius = 80;
                
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
                
                // ç›´å¾„AB
                ctx.beginPath();
                ctx.moveTo(centerX - radius, centerY);
                ctx.lineTo(centerX + radius, centerY);
                ctx.stroke();
                
                // å¼¦CD
                ctx.beginPath();
                ctx.moveTo(centerX - 50, centerY - 60);
                ctx.lineTo(centerX - 50, centerY + 60);
                ctx.stroke();
                
                // æ ‡æ³¨
                ctx.fillStyle = '#333';
                ctx.font = '14px Noto Sans SC';
                ctx.fillText('A', centerX - radius - 15, centerY + 5);
                ctx.fillText('B', centerX + radius + 5, centerY + 5);
                ctx.fillText('C', centerX - 50 - 25, centerY - 60);
                ctx.fillText('D', centerX - 50 - 25, centerY + 65);
                ctx.fillText('O', centerX + 5, centerY - 10);
                ctx.fillText('E', centerX - 50 - 15, centerY - 10);
                
                // åœ†å¿ƒ
                ctx.beginPath();
                ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
                ctx.fill();
            } else {
                // ç”»å¹³è¡Œå››è¾¹å½¢/çŸ©å½¢
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.moveTo(80, 180);
                ctx.lineTo(200, 180);
                ctx.lineTo(280, 80);
                ctx.lineTo(160, 80);
                ctx.closePath();
                ctx.stroke();
                
                // æ ‡æ³¨
                ctx.fillStyle = '#333';
                ctx.font = '14px Noto Sans SC';
                ctx.fillText('A', 65, 195);
                ctx.fillText('B', 205, 195);
                ctx.fillText('C', 285, 80);
                ctx.fillText('D', 145, 75);
                
                // å¯¹è§’çº¿
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(80, 180);
                ctx.lineTo(280, 80);
                ctx.moveTo(200, 180);
                ctx.lineTo(160, 80);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillText('O', 215, 135);
            }
        }

        function selectGeometryOption(index) {
            selectedGeometryOption = index;
            document.querySelectorAll('#geometry-options .option').forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) opt.classList.add('selected');
            });
        }

        function checkGeometryAnswer() {
            if (selectedGeometryOption === -1) {
                document.getElementById('geometry-result').className = 'result wrong';
                document.getElementById('geometry-result').textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼';
                return;
            }
            
            const isCorrect = selectedGeometryOption === currentGeometryQuestion.correct;
            const correctText = currentGeometryQuestion.options[currentGeometryQuestion.correct];
            
            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            document.querySelectorAll('#geometry-options .option').forEach((opt, i) => {
                if (i === currentGeometryQuestion.correct) {
                    opt.classList.add('correct-answer');
                } else if (i === selectedGeometryOption && !isCorrect) {
                    opt.classList.add('wrong-answer');
                }
            });
            
            showResult('geometry', isCorrect, String.fromCharCode(65 + currentGeometryQuestion.correct) + '. ' + correctText);
            updateStats(isCorrect);
            selectedGeometryOption = -1;
        }

        function showGeometryHint() {
            const hintDiv = document.getElementById('geometry-hint');
            
            if (currentGeometryQuestion.type === 'circle') {
                hintDiv.innerHTML = `
                    <strong>åœ†çš„å…³é”®å®šç†ï¼š</strong><br>
                    1. åœ†å‘¨è§’å®šç†ï¼šåŒå¼§æ‰€å¯¹åœ†å‘¨è§’ç›¸ç­‰<br>
                    2. å‚å¾„å®šç†ï¼šå‚ç›´äºå¼¦çš„ç›´å¾„å¹³åˆ†å¼¦<br>
                    3. åˆ‡çº¿æ€§è´¨ï¼šè¿‡åŠå¾„å¤–ç«¯çš„åˆ‡çº¿å‚ç›´äºåŠå¾„<br>
                    4. ç›´å¾„æ‰€å¯¹åœ†å‘¨è§’ä¸º90Â°<br><br>
                    <strong>æœ¬é¢˜å…³é”®ï¼š</strong><br>
                    â€¢ BFâŠ¥OBï¼ˆåˆ‡çº¿æ€§è´¨ï¼‰<br>
                    â€¢ CDâŠ¥ABï¼Œâˆ´ CD//BF<br>
                    â€¢ ç”¨å‹¾è‚¡å®šç†æ±‚å¼¦é•¿`;
            } else if (currentGeometryQuestion.type === 'parallelogram') {
                hintDiv.innerHTML = `
                    <strong>å¹³è¡Œå››è¾¹å½¢åˆ¤å®šæ–¹æ³•ï¼š</strong><br>
                    1. ä¸¤ç»„å¯¹è¾¹åˆ†åˆ«å¹³è¡Œ<br>
                    2. ä¸¤ç»„å¯¹è¾¹åˆ†åˆ«ç›¸ç­‰<br>
                    3. ä¸€ç»„å¯¹è¾¹å¹³è¡Œä¸”ç›¸ç­‰<br>
                    4. å¯¹è§’çº¿äº’ç›¸å¹³åˆ†<br>
                    5. ä¸¤ç»„å¯¹è§’åˆ†åˆ«ç›¸ç­‰<br><br>
                    <strong>æ³¨æ„ï¼š</strong><br>
                    â€¢ AC=BD ä¸èƒ½åˆ¤å®šå¹³è¡Œå››è¾¹å½¢ï¼ˆåªæ˜¯å¯¹è§’çº¿ç›¸ç­‰ï¼‰`;
            } else {
                hintDiv.innerHTML = `
                    <strong>çŸ©å½¢åˆ¤å®šæ–¹æ³•ï¼š</strong><br>
                    1. æœ‰ä¸€ä¸ªè§’æ˜¯ç›´è§’çš„å¹³è¡Œå››è¾¹å½¢<br>
                    2. å¯¹è§’çº¿ç›¸ç­‰çš„å¹³è¡Œå››è¾¹å½¢<br>
                    3. å››ä¸ªè§’éƒ½æ˜¯ç›´è§’çš„å››è¾¹å½¢<br><br>
                    <strong>ç‰¹æ®Šå››è¾¹å½¢å…³ç³»ï¼š</strong><br>
                    â€¢ çŸ©å½¢ï¼šå¯¹è§’çº¿ç›¸ç­‰<br>
                    â€¢ è±å½¢ï¼šå¯¹è§’çº¿å‚ç›´<br>
                    â€¢ æ­£æ–¹å½¢ï¼šæ—¢ç›¸ç­‰åˆå‚ç›´`;
            }
            hintDiv.style.display = 'block';
        }

        // ==================== è€ƒè¯•æ¨¡å¼ ====================
        let examQuestions = [];
        let examAnswers = [];
        let currentExamIndex = 0;
        let examTimer = null;
        let examTimeLeft = 30 * 60; // 30åˆ†é’Ÿ
        let examStartTime = null;

        // å¼€å§‹è€ƒè¯•
        function startExam() {
            if (!confirm('å³å°†å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•ï¼ˆ30åˆ†é’Ÿï¼Œ12é“é¢˜ï¼‰\nå¼€å§‹åå°†æ— æ³•æš‚åœï¼Œç¡®å®šå¼€å§‹å—ï¼Ÿ')) {
                return;
            }
            
            // éšè—ç»ƒä¹ æ¨¡å¼
            document.getElementById('practice-tabs').style.display = 'none';
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            
            // æ˜¾ç¤ºè€ƒè¯•æ¨¡å¼
            document.getElementById('exam-container').classList.add('active');
            document.querySelector('.start-exam-btn').style.display = 'none';
            
            // ç”Ÿæˆè€ƒè¯•é¢˜ç›®
            generateExamQuestions();
            
            // é‡ç½®çŠ¶æ€
            examAnswers = new Array(12).fill(null);
            currentExamIndex = 0;
            examTimeLeft = 30 * 60;
            examStartTime = Date.now();
            
            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            showExamQuestion(0);
            
            // å¼€å§‹è®¡æ—¶
            startExamTimer();
        }

        // ç”Ÿæˆè€ƒè¯•é¢˜ç›®ï¼ˆ12é“ï¼Œè¦†ç›–æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼‰
        function generateExamQuestions() {
            examQuestions = [];
            
            // å®šä¹‰é¢˜ç›®ç±»å‹åŠåˆ†å€¼
            const questionTypes = [
                { type: 'function', name: 'å‡½æ•°å›¾åƒ', count: 2, points: 8 },
                { type: 'moving', name: 'åŠ¨ç‚¹é—®é¢˜', count: 2, points: 10 },
                { type: 'transform', name: 'åæ ‡å˜æ¢', count: 1, points: 6 },
                { type: 'quadratic', name: 'äºŒæ¬¡å‡½æ•°', count: 2, points: 8 },
                { type: 'equation', name: 'æ–¹ç¨‹æ ¹', count: 2, points: 8 },
                { type: 'inequality', name: 'ä¸ç­‰å¼', count: 1, points: 6 },
                { type: 'probability', name: 'æ¦‚ç‡', count: 1, points: 6 },
                { type: 'geometry', name: 'å‡ ä½•è¯æ˜', count: 1, points: 6 }
            ];
            
            let questionIndex = 0;
            
            questionTypes.forEach(qt => {
                for (let i = 0; i < qt.count; i++) {
                    const question = generateQuestionByType(qt.type);
                    examQuestions.push({
                        ...question,
                        index: questionIndex++,
                        typeName: qt.name,
                        points: qt.points,
                        flagged: false
                    });
                }
            });
            
            // æ›´æ–°å¯¼èˆª
            updateExamNav();
        }

        // æ ¹æ®ç±»å‹ç”Ÿæˆé¢˜ç›®
        function generateQuestionByType(type) {
            switch(type) {
                case 'function': return generateFunctionQuestionData();
                case 'moving': return generateMovingQuestionData();
                case 'transform': return generateTransformQuestionData();
                case 'quadratic': return generateQuadraticQuestionData();
                case 'equation': return generateEquationQuestionData();
                case 'inequality': return generateInequalityQuestionData();
                case 'probability': return generateProbabilityQuestionData();
                case 'geometry': return generateGeometryQuestionData();
            }
        }

        // å„ç±»å‹é¢˜ç›®æ•°æ®ç”Ÿæˆï¼ˆç®€åŒ–ç‰ˆï¼Œè¿”å›æ•°æ®å¯¹è±¡ï¼‰
        function generateFunctionQuestionData() {
            const type = Math.random() > 0.5 ? 'linear' : 'inverse';
            if (type === 'linear') {
                const k = (Math.floor(Math.random() * 5) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const b = (Math.floor(Math.random() * 8) + 1) * (Math.random() > 0.5 ? 1 : -1);
                const x1 = 1, y1 = k + b;
                const x2 = 2, y2 = 2*k + b;
                return {
                    type: 'function',
                    subType: 'linear',
                    question: `ã€ä¸€æ¬¡å‡½æ•°ã€‘ç›´çº¿ç»è¿‡ç‚¹ A(${x1}, ${y1}) å’Œ B(${x2}, ${y2})ï¼Œæ±‚å‡½æ•°è§£æå¼ã€‚`,
                    answer: `y=${k}x${b>=0?'+':''}${b}`,
                    inputType: 'text',
                    knowledgePoint: 'ä¸€æ¬¡å‡½æ•°',
                    feedback: getFunctionFeedback()
                };
            } else {
                const k = (Math.floor(Math.random() * 12) + 4) * 2;
                const x = 2, y = k / 2;
                return {
                    type: 'function',
                    subType: 'inverse',
                    question: `ã€åæ¯”ä¾‹å‡½æ•°ã€‘åŒæ›²çº¿ç»è¿‡ç‚¹ A(${x}, ${y})ï¼Œæ±‚å‡½æ•°è§£æå¼ã€‚`,
                    answer: `y=${k}/x`,
                    inputType: 'text',
                    knowledgePoint: 'åæ¯”ä¾‹å‡½æ•°',
                    feedback: getFunctionFeedback()
                };
            }
        }

        function generateMovingQuestionData() {
            const w = Math.floor(Math.random() * 4) + 6;
            const h = Math.floor(Math.random() * 4) + 6;
            const v = Math.floor(Math.random() * 3) + 1;
            return {
                type: 'moving',
                question: `ã€åŠ¨ç‚¹é—®é¢˜ã€‘çŸ©å½¢ABCDï¼ŒAB=${w}ï¼ŒBC=${h}ã€‚ç‚¹Pä»Aå‡ºå‘æ²¿ADä»¥æ¯ç§’${v}å•ä½è¿åŠ¨ï¼ŒåŒæ—¶ç‚¹Qä»Bå‡ºå‘æ²¿BCä»¥æ¯ç§’${v}å•ä½è¿åŠ¨ã€‚æ±‚â–³PBQé¢ç§¯Sä¸æ—¶é—´tçš„å…³ç³»å¼ã€‚`,
                answer: `S=${w*v/2}t`,
                inputType: 'text',
                knowledgePoint: 'åŠ¨ç‚¹ä¸é¢ç§¯',
                feedback: getMovingFeedback()
            };
        }

        function generateTransformQuestionData() {
            const x = Math.floor(Math.random() * 5) + 1;
            const y = Math.floor(Math.random() * 5) + 1;
            const rotation = Math.random() > 0.5;
            if (rotation) {
                return {
                    type: 'transform',
                    question: `ã€åæ ‡æ—‹è½¬ã€‘ç‚¹Aåæ ‡(${x},${y})ï¼Œç»•åŸç‚¹Oé€†æ—¶é’ˆæ—‹è½¬90Â°å¾—åˆ°ç‚¹A'ï¼Œæ±‚A'åæ ‡ã€‚`,
                    answer: `(${-y},${x})`,
                    inputType: 'text',
                    knowledgePoint: 'åæ ‡æ—‹è½¬',
                    feedback: getTransformFeedback()
                };
            } else {
                const n = Math.floor(Math.random() * 4) + 2;
                return {
                    type: 'transform',
                    question: `ã€åæ ‡å¹³ç§»ã€‘ç‚¹Aåæ ‡(${x},${y})ï¼Œå‘ä¸‹å¹³ç§»${n}ä¸ªå•ä½å¾—åˆ°ç‚¹A'ï¼Œæ±‚A'åæ ‡ã€‚`,
                    answer: `(${x},${y-n})`,
                    inputType: 'text',
                    knowledgePoint: 'åæ ‡å¹³ç§»',
                    feedback: getTransformFeedback()
                };
            }
        }

        function generateQuadraticQuestionData() {
            const questions = [
                {
                    question: `ã€äºŒæ¬¡å‡½æ•°æ€§è´¨ã€‘äºŒæ¬¡å‡½æ•°y=axÂ²+bx+cçš„å›¾åƒå¼€å£å‘ä¸‹ï¼Œå¯¹ç§°è½´x=1ï¼Œä¸yè½´äº¤äºæ­£åŠè½´ã€‚ä¸‹åˆ—ç»“è®ºæ­£ç¡®çš„æ˜¯ï¼šâ‘ abc>0 â‘¡b=2a â‘¢a+b+c>0`,
                    options: ['â‘ â‘¡', 'â‘¡â‘¢', 'â‘ â‘¢', 'â‘ â‘¡â‘¢'],
                    answer: 1,
                    inputType: 'choice'
                },
                {
                    question: `ã€äºŒæ¬¡å‡½æ•°ã€‘æŠ›ç‰©çº¿y=xÂ²-4x+3çš„é¡¶ç‚¹åæ ‡æ˜¯ï¼š`,
                    options: ['(2,-1)', '(2,1)', '(-2,-1)', '(-2,1)'],
                    answer: 0,
                    inputType: 'choice'
                }
            ];
            const q = questions[Math.floor(Math.random() * questions.length)];
            return {
                type: 'quadratic',
                ...q,
                knowledgePoint: 'äºŒæ¬¡å‡½æ•°æ€§è´¨',
                feedback: getQuadraticFeedback()
            };
        }

        function generateEquationQuestionData() {
            const sum = Math.floor(Math.random() * 10) + 5;
            const product = Math.floor(Math.random() * 10) + 5;
            const types = ['sum', 'product', 'expression'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'sum') {
                return {
                    type: 'equation',
                    question: `ã€éŸ¦è¾¾å®šç†ã€‘æ–¹ç¨‹xÂ²-${sum}x+${product}=0çš„ä¸¤æ ¹ä¸ºxâ‚,xâ‚‚ï¼Œæ±‚xâ‚+xâ‚‚çš„å€¼ã€‚`,
                    answer: `${sum}`,
                    inputType: 'text',
                    knowledgePoint: 'éŸ¦è¾¾å®šç†',
                    feedback: getEquationFeedback()
                };
            } else if (type === 'product') {
                return {
                    type: 'equation',
                    question: `ã€éŸ¦è¾¾å®šç†ã€‘æ–¹ç¨‹xÂ²-${sum}x+${product}=0çš„ä¸¤æ ¹ä¸ºxâ‚,xâ‚‚ï¼Œæ±‚xâ‚Â·xâ‚‚çš„å€¼ã€‚`,
                    answer: `${product}`,
                    inputType: 'text',
                    knowledgePoint: 'éŸ¦è¾¾å®šç†',
                    feedback: getEquationFeedback()
                };
            } else {
                const result = product - 2*sum + 4;
                return {
                    type: 'equation',
                    question: `ã€éŸ¦è¾¾å®šç†ã€‘æ–¹ç¨‹xÂ²-${sum}x+${product}=0çš„ä¸¤æ ¹ä¸ºxâ‚,xâ‚‚ï¼Œæ±‚(xâ‚-2)(xâ‚‚-2)çš„å€¼ã€‚`,
                    answer: `${result}`,
                    inputType: 'text',
                    knowledgePoint: 'éŸ¦è¾¾å®šç†åº”ç”¨',
                    feedback: getEquationFeedback()
                };
            }
        }

        function generateInequalityQuestionData() {
            return {
                type: 'inequality',
                question: `ã€ä¸ç­‰å¼ç»„ã€‘è§£ä¸ç­‰å¼ç»„ï¼š{2x+1>3 ä¸” x+2<5}`,
                answer: '1<x<3',
                inputType: 'text',
                knowledgePoint: 'ä¸ç­‰å¼ç»„æ±‚è§£',
                feedback: getInequalityFeedback()
            };
        }

        function generateProbabilityQuestionData() {
            return {
                type: 'probability',
                question: `ã€æ¦‚ç‡ã€‘ç”²ä»A,B,Cä¸­éšæœºé€‰ä¸€ä¸ªï¼Œä¹™ä»B,C,Dä¸­éšæœºé€‰ä¸€ä¸ªï¼Œç”¨æ ‘çŠ¶å›¾æ±‚ä¸¤äººé€‰åˆ°ç›¸åŒç±»åˆ«çš„æ¦‚ç‡ã€‚`,
                answer: '2/9',
                inputType: 'text',
                knowledgePoint: 'æ ‘çŠ¶å›¾æ¦‚ç‡',
                feedback: getProbabilityFeedback()
            };
        }

        function generateGeometryQuestionData() {
            const questions = [
                {
                    question: `ã€åœ†çš„æ€§è´¨ã€‘ABæ˜¯âŠ™Oçš„ç›´å¾„ï¼Œå¼¦CDâŠ¥ABäºEã€‚ä¸‹åˆ—ç»“è®ºæ­£ç¡®çš„ä¸ªæ•°æ˜¯ï¼šâ‘ âˆ ACD=âˆ ABD â‘¡CE=ED â‘¢âˆ ACB=90Â°`,
                    options: ['0ä¸ª', '1ä¸ª', '2ä¸ª', '3ä¸ª'],
                    answer: 3,
                    inputType: 'choice'
                },
                {
                    question: `ã€å¹³è¡Œå››è¾¹å½¢ã€‘ä¸‹åˆ—æ¡ä»¶èƒ½åˆ¤å®šå››è¾¹å½¢æ˜¯å¹³è¡Œå››è¾¹å½¢çš„æ˜¯ï¼šâ‘ å¯¹è§’çº¿äº’ç›¸å¹³åˆ† â‘¡ä¸€ç»„å¯¹è¾¹ç›¸ç­‰ â‘¢ä¸¤ç»„å¯¹è§’ç›¸ç­‰`,
                    options: ['â‘ â‘¡', 'â‘ â‘¢', 'â‘¡â‘¢', 'â‘ â‘¡â‘¢'],
                    answer: 1,
                    inputType: 'choice'
                }
            ];
            const q = questions[Math.floor(Math.random() * questions.length)];
            return {
                type: 'geometry',
                ...q,
                knowledgePoint: 'å‡ ä½•è¯æ˜',
                feedback: getGeometryFeedback()
            };
        }

        // æ˜¾ç¤ºè€ƒè¯•é¢˜ç›®
        function showExamQuestion(index) {
            currentExamIndex = index;
            const q = examQuestions[index];
            
            document.getElementById('exam-q-number').textContent = `ç¬¬ ${index + 1} é¢˜ï¼ˆ${q.points}åˆ†ï¼‰`;
            document.getElementById('exam-q-type').textContent = q.typeName;
            document.getElementById('exam-question').innerHTML = q.question;
            
            // ç»˜åˆ¶å›¾å½¢
            drawExamGraph(q);
            
            // æ˜¾ç¤ºé€‰é¡¹æˆ–è¾“å…¥æ¡†
            const optionsDiv = document.getElementById('exam-options');
            const inputGroup = document.getElementById('exam-input-group');
            
            if (q.inputType === 'choice') {
                optionsDiv.style.display = 'grid';
                optionsDiv.className = 'options';
                inputGroup.style.display = 'none';
                
                optionsDiv.innerHTML = q.options.map((opt, i) => 
                    `<div class="option ${examAnswers[index] === i ? 'selected' : ''}" 
                          onclick="selectExamOption(${i})" id="exam-opt-${i}">
                          ${String.fromCharCode(65 + i)}. ${opt}
                      </div>`
                ).join('');
            } else {
                optionsDiv.style.display = 'none';
                inputGroup.style.display = 'block';
                document.getElementById('exam-answer').value = examAnswers[index] || '';
            }
            
            // æ›´æ–°å¯¼èˆª
            updateExamNav();
        }

        // è€ƒè¯•æ¨¡å¼ç»˜å›¾
        function drawExamGraph(q) {
            const canvas = document.getElementById('exam-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            if (q.type === 'function') {
                drawExamFunction(ctx, w, h, q);
            } else if (q.type === 'moving') {
                drawExamMoving(ctx, w, h, q);
            } else if (q.type === 'transform') {
                drawExamTransform(ctx, w, h, q);
            } else if (q.type === 'quadratic') {
                drawExamQuadratic(ctx, w, h);
            } else if (q.type === 'equation') {
                drawExamEquation(ctx, w, h, q);
            } else if (q.type === 'inequality') {
                drawExamInequality(ctx, w, h, q);
            } else if (q.type === 'probability') {
                drawExamProbability(ctx, w, h, q);
            } else if (q.type === 'geometry') {
                drawExamGeometry(ctx, w, h, q);
            }
        }

        function drawExamFunction(ctx, w, h, q) {
            // ç»˜åˆ¶åæ ‡ç³»
            const padding = 40;
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // x è½´
            ctx.beginPath();
            ctx.moveTo(padding, h/2);
            ctx.lineTo(w - padding, h/2);
            ctx.stroke();
            
            // y è½´
            ctx.beginPath();
            ctx.moveTo(w/2, padding);
            ctx.lineTo(w/2, h - padding);
            ctx.stroke();
            
            // åˆ»åº¦
            ctx.fillStyle = '#666';
            ctx.font = '12px Noto Sans SC';
            ctx.textAlign = 'center';
            
            for (let i = -4; i <= 4; i++) {
                if (i !== 0) {
                    const x = w/2 + i * 30;
                    ctx.fillText(i.toString(), x, h/2 + 20);
                    const y = h/2 - i * 30;
                    ctx.fillText(i.toString(), w/2 - 15, y + 4);
                }
            }
            
            if (q.subType === 'linear') {
                // ç”»ç›´çº¿
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(padding, h/2 - 60);
                ctx.lineTo(w - padding, h/2 + 60);
                ctx.stroke();
                
                // æ ‡è®°ç‚¹
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(w/2 + 30, h/2 - 30, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('A', w/2 + 45, h/2 - 35);
                
                ctx.beginPath();
                ctx.arc(w/2 + 60, h/2 - 60, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('B', w/2 + 75, h/2 - 65);
            } else {
                // ç”»åŒæ›²çº¿
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let x = 0.3; x <= 4; x += 0.1) {
                    const y = 6 / x;
                    if (y <= 4) {
                        const px = w/2 + x * 30;
                        const py = h/2 - y * 30;
                        if (x === 0.3) ctx.moveTo(px, py);
                        else ctx.lineTo(px, py);
                    }
                }
                ctx.stroke();
                
                ctx.beginPath();
                for (let x = -4; x <= -0.3; x += 0.1) {
                    const y = 6 / x;
                    if (y >= -4) {
                        const px = w/2 + x * 30;
                        const py = h/2 - y * 30;
                        if (x === -4) ctx.moveTo(px, py);
                        else ctx.lineTo(px, py);
                    }
                }
                ctx.stroke();
                
                // æ ‡è®°ç‚¹
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(w/2 + 60, h/2 - 90, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('A(2,3)', w/2 + 75, h/2 - 85);
            }
        }

        function drawExamMoving(ctx, w, h, q) {
            // ç”»çŸ©å½¢
            const rectW = 180, rectH = 120;
            const x = (w - rectW) / 2, y = (h - rectH) / 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y, rectW, rectH);
            
            // æ ‡æ³¨é¡¶ç‚¹
            ctx.fillStyle = '#333';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('A', x - 15, y + rectH + 5);
            ctx.fillText('B', x + rectW + 5, y + rectH + 5);
            ctx.fillText('C', x + rectW + 5, y - 5);
            ctx.fillText('D', x - 15, y - 5);
            
            // è¾¹é•¿æ ‡æ³¨
            ctx.fillStyle = '#666';
            ctx.fillText('AB=8', x + rectW/2, y + rectH + 25);
            ctx.fillText('BC=6', x + rectW + 25, y + rectH/2);
            
            // åŠ¨ç‚¹
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(x, y + rectH/2, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('P', x - 20, y + rectH/2 + 5);
            
            ctx.beginPath();
            ctx.arc(x + rectW, y + rectH/2, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('Q', x + rectW + 15, y + rectH/2 + 5);
            
            // è¿åŠ¨æ–¹å‘ç®­å¤´
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            drawArrow(ctx, x, y + rectH - 20, x, y + 20, 'up');
            drawArrow(ctx, x + rectW, y + rectH - 20, x + rectW, y + 20, 'up');
        }

        function drawExamTransform(ctx, w, h, q) {
            // ç»˜åˆ¶åæ ‡ç³»
            const padding = 40;
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(padding, h/2);
            ctx.lineTo(w - padding, h/2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(w/2, padding);
            ctx.lineTo(w/2, h - padding);
            ctx.stroke();
            
            // åŸç‚¹
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('O', w/2 - 15, h/2 + 20);
            
            // åŸå§‹ç‚¹A
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(w/2 + 90, h/2 - 90, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText('A(3,3)', w/2 + 100, h/2 - 95);
            
            // å˜æ¢åçš„ç‚¹A'
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(w/2 - 90, h/2 - 90, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillText("A'", w/2 - 105, h/2 - 75);
            
            // è¿æ¥çº¿
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(w/2, h/2, 90, -Math.PI/4, Math.PI/4, false);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawExamQuadratic(ctx, w, h) {
            // ç»˜åˆ¶åæ ‡ç³»
            const padding = 40;
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(padding, h/2);
            ctx.lineTo(w - padding, h/2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(w/2, padding);
            ctx.lineTo(w/2, h - padding);
            ctx.stroke();
            
            // ç”»æŠ›ç‰©çº¿
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let px = padding; px <= w - padding; px++) {
                const x = (px - w/2) / 30;
                const y = x * x - 2;
                const py = h/2 - y * 25;
                if (py >= padding && py <= h - padding) {
                    if (px === padding) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            
            // å¯¹ç§°è½´
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(w/2, padding);
            ctx.lineTo(w/2, h - padding);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '12px Noto Sans SC';
            ctx.fillText('å¯¹ç§°è½´ x=1', w/2 + 10, padding + 20);
        }

        function drawExamEquation(ctx, w, h, q) {
            // ç»˜åˆ¶ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ç¤ºæ„å›¾
            ctx.fillStyle = '#333';
            ctx.font = '16px Noto Sans SC';
            ctx.textAlign = 'center';
            
            // æ–¹ç¨‹æ¡†
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.strokeRect(w/2 - 100, h/2 - 30, 200, 60);
            
            ctx.fillText('éŸ¦è¾¾å®šç†', w/2, h/2 - 50);
            ctx.fillText('xâ‚ + xâ‚‚ = -b/a', w/2, h/2 - 5);
            ctx.fillText('xâ‚ Â· xâ‚‚ = c/a', w/2, h/2 + 25);
            
            // è£…é¥°
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(w/2 - 80, h/2, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(w/2 + 80, h/2, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px Noto Sans SC';
            ctx.fillText('xâ‚', w/2 - 80, h/2 - 15);
            ctx.fillText('xâ‚‚', w/2 + 80, h/2 - 15);
        }

        function drawExamInequality(ctx, w, h, q) {
            // ç»˜åˆ¶æ•°è½´å’Œè§£é›†
            const padding = 40;
            
            // æ•°è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, h/2);
            ctx.lineTo(w - padding, h/2);
            ctx.stroke();
            
            // ç®­å¤´
            ctx.beginPath();
            ctx.moveTo(w - padding - 10, h/2 - 5);
            ctx.lineTo(w - padding, h/2);
            ctx.lineTo(w - padding - 10, h/2 + 5);
            ctx.stroke();
            
            // åˆ»åº¦
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            ctx.textAlign = 'center';
            
            for (let i = -2; i <= 5; i++) {
                const x = padding + 40 + i * 40;
                ctx.beginPath();
                ctx.moveTo(x, h/2 - 5);
                ctx.lineTo(x, h/2 + 5);
                ctx.stroke();
                ctx.fillText(i.toString(), x, h/2 + 25);
            }
            
            // è§£é›†åŒºåŸŸï¼ˆ1 < x < 3ï¼‰
            ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
            ctx.fillRect(padding + 40 + 1*40 + 5, h/2 - 30, 2*40 - 10, 60);
            
            // ç©ºå¿ƒåœ†ï¼ˆä¸åŒ…å«è¾¹ç•Œï¼‰
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(padding + 40 + 1*40, h/2, 8, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(padding + 40 + 3*40, h/2, 8, 0, Math.PI * 2);
            ctx.stroke();
            
            // æ ‡ç­¾
            ctx.fillStyle = '#667eea';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('1 < x < 3', w/2, h/2 - 50);
            ctx.fillText('è§£é›†åŒºåŸŸ', w/2, h/2 - 70);
        }

        function drawExamProbability(ctx, w, h, q) {
            // ç”»æ ‘çŠ¶å›¾
            ctx.fillStyle = '#666';
            ctx.font = '14px Noto Sans SC';
            
            // èµ·ç‚¹
            ctx.beginPath();
            ctx.arc(40, h/2, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ç”²çš„åˆ†æ”¯
            const aChoices = ['A', 'B', 'C'];
            aChoices.forEach((choice, i) => {
                const y1 = 40 + i * 50;
                
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(48, h/2);
                ctx.lineTo(100, y1);
                ctx.stroke();
                
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(110, y1, 5, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#333';
                ctx.fillText(choice, 125, y1 + 5);
                
                // ä¹™çš„åˆ†æ”¯
                const bChoices = ['B', 'C', 'D'];
                bChoices.forEach((bChoice, j) => {
                    const y2 = y1 - 20 + j * 20;
                    
                    ctx.strokeStyle = '#764ba2';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(115, y1);
                    ctx.lineTo(180, y2);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#764ba2';
                    ctx.beginPath();
                    ctx.arc(190, y2, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '11px Noto Sans SC';
                    ctx.fillText(bChoice, 200, y2 + 4);
                });
            });
            
            ctx.fillStyle = '#333';
            ctx.font = '14px Noto Sans SC';
            ctx.fillText('ç”²', 70, h/2 - 20);
            ctx.fillText('ä¹™', 150, 25);
        }

        function drawExamGeometry(ctx, w, h, q) {
            if (q.question.includes('åœ†')) {
                // ç”»åœ†
                const centerX = w/2, centerY = h/2, radius = 80;
                
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
                
                // ç›´å¾„AB
                ctx.beginPath();
                ctx.moveTo(centerX - radius, centerY);
                ctx.lineTo(centerX + radius, centerY);
                ctx.stroke();
                
                // å¼¦CD
                ctx.beginPath();
                ctx.moveTo(centerX - 40, centerY - 60);
                ctx.lineTo(centerX - 40, centerY + 60);
                ctx.stroke();
                
                // æ ‡æ³¨
                ctx.fillStyle = '#333';
                ctx.font = '14px Noto Sans SC';
                ctx.fillText('A', centerX - radius - 15, centerY + 5);
                ctx.fillText('B', centerX + radius + 5, centerY + 5);
                ctx.fillText('C', centerX - 65, centerY - 60);
                ctx.fillText('D', centerX - 65, centerY + 65);
                ctx.fillText('O', centerX + 5, centerY - 10);
                ctx.fillText('E', centerX - 55, centerY - 10);
                
                // åœ†å¿ƒ
                ctx.beginPath();
                ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
                ctx.fill();
            } else {
                // ç”»å››è¾¹å½¢
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                
                ctx.beginPath();
                ctx.moveTo(80, 180);
                ctx.lineTo(220, 180);
                ctx.lineTo(260, 80);
                ctx.lineTo(120, 80);
                ctx.closePath();
                ctx.stroke();
                
                // æ ‡æ³¨
                ctx.fillStyle = '#333';
                ctx.font = '14px Noto Sans SC';
                ctx.fillText('A', 65, 195);
                ctx.fillText('B', 225, 195);
                ctx.fillText('C', 265, 80);
                ctx.fillText('D', 105, 75);
                
                // å¯¹è§’çº¿
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(80, 180);
                ctx.lineTo(260, 80);
                ctx.moveTo(220, 180);
                ctx.lineTo(120, 80);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillText('O', 185, 135);
            }
        }

        // é€‰æ‹©é¢˜é€‰é¡¹
        function selectExamOption(index) {
            document.querySelectorAll('#exam-options .option').forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) opt.classList.add('selected');
            });
            examAnswers[currentExamIndex] = index;
            updateExamNav();
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®
        function updateExamNav() {
            const navDiv = document.getElementById('exam-question-nav');
            navDiv.innerHTML = examQuestions.map((q, i) => {
                let className = 'question-nav-btn';
                if (i === currentExamIndex) className += ' current';
                else if (examAnswers[i] !== null) className += ' answered';
                if (q.flagged) className += ' flagged';
                return `<button class="${className}" onclick="showExamQuestion(${i})">${i + 1}</button>`;
            }).join('');
            
            // æ›´æ–°è¿›åº¦
            const answered = examAnswers.filter(a => a !== null).length;
            document.getElementById('exam-progress-text').textContent = `${answered}/${examQuestions.length}`;
            document.getElementById('exam-progress-fill').style.width = `${answered / examQuestions.length * 100}%`;
        }

        // ä¸Šä¸€é¢˜/ä¸‹ä¸€é¢˜/æ ‡è®°
        function prevExamQuestion() {
            if (currentExamIndex > 0) {
                saveExamAnswer();
                showExamQuestion(currentExamIndex - 1);
            }
        }

        function nextExamQuestion() {
            saveExamAnswer();
            if (currentExamIndex < examQuestions.length - 1) {
                showExamQuestion(currentExamIndex + 1);
            }
        }

        function flagExamQuestion() {
            examQuestions[currentExamIndex].flagged = !examQuestions[currentExamIndex].flagged;
            updateExamNav();
        }

        function saveExamAnswer() {
            const q = examQuestions[currentExamIndex];
            if (q.inputType === 'text') {
                examAnswers[currentExamIndex] = document.getElementById('exam-answer').value.trim();
            }
        }

        // è®¡æ—¶å™¨
        function startExamTimer() {
            updateTimerDisplay();
            examTimer = setInterval(() => {
                examTimeLeft--;
                updateTimerDisplay();
                
                if (examTimeLeft <= 0) {
                    clearInterval(examTimer);
                    alert('æ—¶é—´åˆ°ï¼è‡ªåŠ¨äº¤å·');
                    submitExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(examTimeLeft / 60);
            const seconds = examTimeLeft % 60;
            const timerDiv = document.getElementById('exam-timer');
            timerDiv.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerDiv.className = 'exam-timer';
            if (examTimeLeft <= 300) timerDiv.classList.add('danger');
            else if (examTimeLeft <= 600) timerDiv.classList.add('warning');
        }

        // äº¤å·
        function submitExam() {
            if (examTimer) clearInterval(examTimer);
            
            saveExamAnswer();
            
            const unanswered = examAnswers.filter(a => a === null || a === '').length;
            if (unanswered > 0) {
                if (!confirm(`è¿˜æœ‰ ${unanswered} é“é¢˜æœªä½œç­”ï¼Œç¡®å®šäº¤å·å—ï¼Ÿ`)) {
                    examTimer = setInterval(() => {
                        examTimeLeft--;
                        updateTimerDisplay();
                        if (examTimeLeft <= 0) {
                            clearInterval(examTimer);
                            submitExam();
                        }
                    }, 1000);
                    return;
                }
            }
            
            // æ‰¹æ”¹
            gradeExam();
        }

        // æ‰¹æ”¹å¹¶ç”ŸæˆæŠ¥å‘Š
        function gradeExam() {
            // éšè—è€ƒè¯•ç•Œé¢
            document.getElementById('exam-container').classList.remove('active');
            
            let correct = 0;
            let wrong = 0;
            let totalScore = 0;
            const wrongQuestions = [];
            const weaknessStats = {};
            
            examQuestions.forEach((q, i) => {
                const userAnswer = examAnswers[i];
                let isCorrect = false;
                
                if (q.inputType === 'choice') {
                    isCorrect = userAnswer === q.answer;
                } else {
                    isCorrect = userAnswer === q.answer || 
                               userAnswer.replace(/\s/g, '') === q.answer.replace(/\s/g, '');
                }
                
                if (isCorrect) {
                    correct++;
                    totalScore += q.points;
                } else {
                    wrong++;
                    wrongQuestions.push({
                        index: i + 1,
                        question: q.question,
                        userAnswer: userAnswer || 'æœªä½œç­”',
                        correctAnswer: q.inputType === 'choice' ? 
                            `${String.fromCharCode(65 + q.answer)}. ${q.options[q.answer]}` : q.answer,
                        knowledgePoint: q.knowledgePoint,
                        feedback: q.feedback,
                        points: q.points
                    });
                    
                    // ç»Ÿè®¡è–„å¼±çŸ¥è¯†ç‚¹
                    weaknessStats[q.knowledgePoint] = (weaknessStats[q.knowledgePoint] || 0) + 1;
                }
            });
            
            // ç”ŸæˆæŠ¥å‘Š
            generateReport(correct, wrong, totalScore, wrongQuestions, weaknessStats);
        }

        // ç”Ÿæˆæˆç»©æŠ¥å‘Š
        function generateReport(correct, wrong, totalScore, wrongQuestions, weaknessStats) {
            document.getElementById('report-card').classList.add('active');
            
            // åˆ†æ•°
            document.getElementById('report-score').textContent = totalScore;
            document.getElementById('report-correct').textContent = correct;
            document.getElementById('report-wrong').textContent = wrong;
            
            // ç”¨æ—¶
            const usedTime = Math.floor((Date.now() - examStartTime) / 1000);
            const minutes = Math.floor(usedTime / 60);
            const seconds = usedTime % 60;
            document.getElementById('report-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // æ­£ç¡®ç‡
            const accuracy = Math.round(correct / examQuestions.length * 100);
            document.getElementById('report-accuracy').textContent = `${accuracy}%`;
            
            // è–„å¼±çŸ¥è¯†ç‚¹
            const weaknessList = document.getElementById('weakness-list');
            const sortedWeakness = Object.entries(weaknessStats).sort((a, b) => b[1] - a[1]);
            
            weaknessList.innerHTML = sortedWeakness.map(([point, count]) => `
                <div class="weakness-item">
                    <h4>âš ï¸ ${point}ï¼ˆé”™${count}é¢˜ï¼‰</h4>
                    <p>å»ºè®®ï¼šé’ˆå¯¹æ­¤çŸ¥è¯†ç‚¹è¿›è¡Œä¸“é¡¹ç»ƒä¹ ï¼Œé‡ç‚¹æŒæ¡è§£é¢˜æŠ€å·§å’Œå…¬å¼åº”ç”¨ã€‚</p>
                </div>
            `).join('');
            
            // é”™é¢˜è¯¦è§£
            const wrongList = document.getElementById('wrong-questions-list');
            wrongList.innerHTML = wrongQuestions.map(wq => `
                <div class="wrong-question">
                    <h4>ç¬¬ ${wq.index} é¢˜ï¼ˆ-${wq.points}åˆ†ï¼‰</h4>
                    <p><strong>é¢˜ç›®ï¼š</strong>${wq.question}</p>
                    <p><strong>ä½ çš„ç­”æ¡ˆï¼š</strong>${wq.userAnswer}</p>
                    <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span style="color: #28a745;">${wq.correctAnswer}</span></p>
                    <p><strong>çŸ¥è¯†ç‚¹ï¼š</strong>${wq.knowledgePoint}</p>
                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        ${wq.feedback}
                    </div>
                </div>
            `).join('');
        }

        // é’ˆå¯¹æ€§å¤ä¹ 
        function reviewWeakness() {
            closeReport();
            // è‡ªåŠ¨è·³è½¬åˆ°ç¬¬ä¸€ä¸ªè–„å¼±çŸ¥è¯†ç‚¹çš„ç»ƒä¹ æ¨¡å—
            alert('å·²è¿”å›ç»ƒä¹ æ¨¡å¼ï¼Œå»ºè®®é‡ç‚¹ç»ƒä¹ åˆšæ‰åšé”™çš„çŸ¥è¯†ç‚¹ï¼');
        }

        // å…³é—­æŠ¥å‘Š
        function closeReport() {
            document.getElementById('report-card').classList.remove('active');
            document.getElementById('practice-tabs').style.display = 'block';
            document.querySelector('.start-exam-btn').style.display = 'inline-block';
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªç»ƒä¹ å¡ç‰‡
            document.querySelectorAll('.card')[0].classList.add('active');
        }

        // é¡µé¢åŠ è½½
        window.onload = function() {
            generateFunctionQuestion();
            generateMovingQuestion();
            generateTransformQuestion();
            generateQuadraticQuestion();
            generateEquationQuestion();
            generateInequalityQuestion();
            generateProbabilityQuestion();
            generateGeometryQuestion();
        };
    </script>
</body>
</html>
